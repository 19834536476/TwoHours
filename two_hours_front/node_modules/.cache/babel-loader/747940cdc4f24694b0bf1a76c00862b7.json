{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport SearchBox from \"@/components/SearchBox\";\nexport default {\n  name: \"StuFileTab\",\n  components: {\n    SearchBox: SearchBox\n  },\n\n  /**\n   * 文件管理\n   */\n  data: function data() {\n    return {\n      // 当前页码\n      fileCurrentPage: 1,\n      // 分页大小\n      filePageSize: 10,\n      // 总页码数\n      fileTotalCount: 1,\n      // 搜索表单数据模型\n      searchName: {\n        title: ''\n      },\n      // 内置查询模型\n      searchFileByName: {\n        title: ''\n      },\n      // 文件上传对话框\n      fileUploadDialogVisible: false,\n      // 文件数据列表\n      fileTableData: [],\n      // 复选框选中数据集合\n      multipleSelection: []\n    };\n  },\n  created: function created() {\n    // 获取文件列表\n    this.getFiles();\n  },\n  methods: {\n    // 获取文件数据\n    getFiles: function getFiles() {\n      var _this = this;\n\n      this.searchFileByName[\"pageSize\"] = this.filePageSize;\n      this.searchFileByName[\"currentPage\"] = this.fileCurrentPage;\n      this.$axios.post(\"/Resource/getPageByCondition\", this.searchFileByName).then(function (res) {\n        if (res.data.flag) {\n          /* 保存公告数据 */\n          _this.fileTableData = res.data.data.records;\n          /* 保存分页数据 */\n\n          _this.fileTotalCount = res.data.data.total;\n          _this.fileCurrentPage = res.data.data.current;\n          _this.filePageSize = res.data.data.size;\n        } else {\n          // 服务故障\n          _this.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 表格颜色控制\n    tableRowClassName: function tableRowClassName(_ref) {\n      var row = _ref.row,\n          rowIndex = _ref.rowIndex;\n\n      if (rowIndex % 4 === 1) {\n        return 'warning-row';\n      } else if (rowIndex % 4 === 3) {\n        return 'success-row';\n      }\n\n      return '';\n    },\n    // 批量下载文件\n    fileDownloadByIds: function fileDownloadByIds() {\n      if (this.multipleSelection.length !== 0) {\n        // 使用勾选的resourceId数组\n        for (var k in this.multipleSelection) {\n          this.downloadFile(this.multipleSelection[k]);\n        } // 刷新列表\n\n\n        this.getFiles();\n      } else {\n        // 未勾选数据时提醒\n        this.$message.info('请选择要删除的数据');\n      }\n    },\n    // 查找文件\n    searchFileOnSubmit: function searchFileOnSubmit(name) {\n      this.searchFileByName.title = name;\n      this.getFiles();\n      /* 清空搜索条件 */\n\n      this.searchName.title = '';\n    },\n    // 当某行数据被点击\n    fileRowClick: function fileRowClick(row) {\n      this.$refs.fileMultipleTable.toggleRowSelection(row);\n    },\n    // 复选框选中后执行的方法\n    fileHandleSelectionChange: function fileHandleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n    // 下载单个文件\n    downloadFile: function downloadFile(row) {\n      var _this2 = this;\n\n      var url = \"http://\" + window.location.host + \"/Files/resourceDownload\"; // window.open(url, '_blank');\n      // 基于base64的前端下载方式\n\n      var xhr = new XMLHttpRequest();\n      xhr.open('post', url);\n      xhr.responseType = 'blob';\n      xhr.setRequestHeader('Content-Type', 'application/json');\n      xhr.send(JSON.stringify({\n        fileName: row.resourceName\n      }));\n\n      xhr.onload = function () {\n        if (this.status === 200 || this.status === 304) {\n          var fileReader = new FileReader();\n          fileReader.readAsDataURL(this.response);\n\n          fileReader.onload = function () {\n            var a = document.createElement('a');\n            a.style.display = 'none';\n            a.href = this.result;\n            a.download = row.resourceName;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n          };\n        }\n      }; // 解决多弹窗重叠问题\n\n\n      setTimeout(function () {\n        _this2.$message.success(\"下载:\" + row.resourceName + \" 完成！\");\n      }, 1000); // 文件下载量增加\n\n      var resource = {\n        resourceId: row.resourceId,\n        downloadNum: row.downloadNum\n      };\n      this.$axios.post(\"/Resource/downloadNumAdd\", resource).then(function (resp) {\n        if (resp.data.flag) {\n          // 写入成功，刷新数据\n          _this2.getFiles();\n        } else {\n          _this2.$message.error('删除失败！');\n        }\n      });\n    },\n    //分页大小变化\n    handleSizeChange: function handleSizeChange(val) {\n      this.filePageSize = val; // 查询所有文件\n\n      this.getFiles();\n    },\n    // 当前页变化\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.fileCurrentPage = val; // 查询所有文件\n\n      this.getFiles();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGA;AACA;AACAA,oBADA;AAEAC;AACAC;AADA,GAFA;;AAKA;AACA;AACA;AACAC,MARA,kBAQA;AACA;AACA;AACAC,wBAFA;AAGA;AACAC,sBAJA;AAKA;AACAC,uBANA;AAOA;AACAC;AACAC;AADA,OARA;AAWA;AACAC;AACAD;AADA,OAZA;AAeA;AACAE,oCAhBA;AAiBA;AACAC,uBAlBA;AAmBA;AACAC;AApBA;AAsBA,GA/BA;AAgCAC,SAhCA,qBAgCA;AACA;AACA;AACA,GAnCA;AAoCAC;AACA;AACAC,YAFA,sBAEA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,SAPA,MAOA;AACA;AACA;AACA;AACA,OAZA;AAaA,KAlBA;AAmBA;AACAC,qBApBA,mCAoBA;AAAA;AAAA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AACA;AACA,KA3BA;AA4BA;AACAC,qBA7BA,+BA6BA;AACA;AACA;AACA;AACA;AACA,SAJA,CAKA;;;AACA;AACA,OAPA,MAOA;AACA;AACA;AACA;AACA,KAzCA;AA0CA;AACAC,sBA3CA,8BA2CAlB,IA3CA,EA2CA;AACA;AACA;AACA;;AACA;AACA,KAhDA;AAiDA;AACAmB,gBAlDA,wBAkDAC,GAlDA,EAkDA;AACA;AACA,KApDA;AAqDA;AACAC,6BAtDA,qCAsDAC,GAtDA,EAsDA;AACA;AACA,KAxDA;AAyDA;AACAC,gBA1DA,wBA0DAH,GA1DA,EA0DA;AAAA;;AACA,6EADA,CAEA;AACA;;AACA;AACAI;AACAA;AACAA;AACAA;AAAAC;AAAA;;AACAD;AACA;AACA;AACAE;;AACAA;AACA;AACAC;AACAA;AACAA;AACAC;AACAD;AACAC;AACA,WARA;AASA;AACA,OAdA,CATA,CAwBA;;;AACAC;AAAA;AAAA,eAzBA,CA0BA;;AACA;AAAAC;AAAAC;AAAA;AACA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,OAPA;AAQA,KA9FA;AA+FA;AACAC,oBAhGA,4BAgGAV,GAhGA,EAgGA;AACA,8BADA,CAEA;;AACA;AACA,KApGA;AAqGA;AACAW,uBAtGA,+BAsGAX,GAtGA,EAsGA;AACA,iCADA,CAEA;;AACA;AACA;AA1GA;AApCA","names":["name","components","SearchBox","data","fileCurrentPage","filePageSize","fileTotalCount","searchName","title","searchFileByName","fileUploadDialogVisible","fileTableData","multipleSelection","created","methods","getFiles","tableRowClassName","fileDownloadByIds","searchFileOnSubmit","fileRowClick","row","fileHandleSelectionChange","val","downloadFile","xhr","fileName","fileReader","a","document","setTimeout","resourceId","downloadNum","handleSizeChange","handleCurrentChange"],"sourceRoot":"src/pages/user/studentComponents","sources":["StuFileTab.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <!-- 功能菜单 -->\r\n        <el-row style=\"margin-top: 20px\">\r\n            <!--按钮-->\r\n            <el-col :span=\"8\">\r\n                <el-row>\r\n                    <el-col :span=\"22\" :offset=\"1\">\r\n                        <el-button type=\"success\" plain @click=\"fileDownloadByIds\">批量下载</el-button>\r\n                    </el-col>\r\n                </el-row>\r\n            </el-col>\r\n            <!--搜索表单-->\r\n            <el-col :span=\"7\" :offset=\"8\">\r\n                <search-box @onSubmit=\"searchFileOnSubmit\"></search-box>\r\n            </el-col>\r\n        </el-row>\r\n\r\n        <!--表格-->\r\n        <template>\r\n            <el-table\r\n                    ref=\"fileMultipleTable\"\r\n                    :data=\"fileTableData\"\r\n                    style=\"width: 100%\"\r\n                    @row-click=\"fileRowClick\"\r\n                    :row-class-name=\"tableRowClassName\"\r\n                    @selection-change=\"fileHandleSelectionChange\">\r\n                <el-table-column\r\n                        type=\"selection\"\r\n                        width=\"55\"\r\n                        align=\"center\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                        label=\"序号\"\r\n                        type=\"index\"\r\n                        width=\"100\"\r\n                        align=\"center\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                        label=\"文件名\"\r\n                        width=\"400\"\r\n                        align=\"center\"\r\n                        sortable>\r\n                    <template slot-scope=\"scope\">\r\n                        <span>{{scope.row.resourceName.substring(6)}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n               <!-- <el-table-column\r\n                        prop=\"resourceName\"\r\n                        label=\"文件名\"\r\n                        width=\"400\"\r\n                        align=\"center\"\r\n                        sortable>\r\n                </el-table-column>-->\r\n                <el-table-column\r\n                        prop=\"resourceSizeStr\"\r\n                        label=\"文件大小\"\r\n                        align=\"center\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"downloadNum\"\r\n                        label=\"下载量\"\r\n                        sortable\r\n                        align=\"center\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"formatDate\"\r\n                        label=\"创建日期\"\r\n                        sortable\r\n                        align=\"center\">\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        align=\"center\"\r\n                        label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" @click=\"downloadFile(scope.row)\">下载</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n\r\n            </el-table>\r\n        </template>\r\n\r\n        <!--分页工具条 数据小于10条不展示-->\r\n        <el-pagination\r\n                id=\"pageBar\"\r\n                v-show=\"fileTotalCount >= 10\"\r\n                @size-change=\"handleSizeChange\"\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"fileCurrentPage\"\r\n                :page-sizes=\"[5, 10, 15, 20, 50, 100]\"\r\n                :page-size=\"filePageSize\"\r\n                layout=\"total, sizes, prev, pager, next, jumper\"\r\n                :total=\"fileTotalCount\">\r\n        </el-pagination>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import SearchBox from \"@/components/SearchBox\";\r\n    export default {\r\n        name: \"StuFileTab\",\r\n        components:{\r\n            SearchBox,\r\n        },\r\n        /**\r\n         * 文件管理\r\n         */\r\n        data(){\r\n            return{\r\n                // 当前页码\r\n                fileCurrentPage: 1,\r\n                // 分页大小\r\n                filePageSize: 10,\r\n                // 总页码数\r\n                fileTotalCount: 1,\r\n                // 搜索表单数据模型\r\n                searchName:{\r\n                    title:'',\r\n                },\r\n                // 内置查询模型\r\n                searchFileByName:{\r\n                    title:'',\r\n                },\r\n                // 文件上传对话框\r\n                fileUploadDialogVisible:false,\r\n                // 文件数据列表\r\n                fileTableData:[],\r\n                // 复选框选中数据集合\r\n                multipleSelection: [],\r\n            }\r\n        },\r\n        created() {\r\n            // 获取文件列表\r\n            this.getFiles();\r\n        },\r\n        methods:{\r\n            // 获取文件数据\r\n            getFiles(){\r\n                this.searchFileByName[\"pageSize\"]=this.filePageSize;\r\n                this.searchFileByName[\"currentPage\"]=this.fileCurrentPage;\r\n                this.$axios.post(\"/Resource/getPageByCondition\",this.searchFileByName).then((res)=>{\r\n                    if(res.data.flag){\r\n                        /* 保存公告数据 */\r\n                        this.fileTableData = res.data.data.records;\r\n                        /* 保存分页数据 */\r\n                        this.fileTotalCount = res.data.data.total;\r\n                        this.fileCurrentPage = res.data.data.current;\r\n                        this.filePageSize = res.data.data.size;\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 表格颜色控制\r\n            tableRowClassName({row, rowIndex}) {\r\n                if (rowIndex%4 === 1) {\r\n                    return 'warning-row';\r\n                } else if (rowIndex%4 === 3) {\r\n                    return 'success-row';\r\n                }\r\n                return '';\r\n            },\r\n            // 批量下载文件\r\n            fileDownloadByIds(){\r\n                if(this.multipleSelection.length !== 0){\r\n                    // 使用勾选的resourceId数组\r\n                    for(let k in this.multipleSelection){\r\n                        this.downloadFile(this.multipleSelection[k]);\r\n                    }\r\n                    // 刷新列表\r\n                    this.getFiles();\r\n                }else{\r\n                    // 未勾选数据时提醒\r\n                    this.$message.info('请选择要删除的数据');\r\n                }\r\n            },\r\n            // 查找文件\r\n            searchFileOnSubmit(name){\r\n                this.searchFileByName.title = name;\r\n                this.getFiles();\r\n                /* 清空搜索条件 */\r\n                this.searchName.title='';\r\n            },\r\n            // 当某行数据被点击\r\n            fileRowClick(row){\r\n                this.$refs.fileMultipleTable.toggleRowSelection(row);\r\n            },\r\n            // 复选框选中后执行的方法\r\n            fileHandleSelectionChange(val) {\r\n                this.multipleSelection = val;\r\n            },\r\n            // 下载单个文件\r\n            downloadFile(row){\r\n                let url = \"http://\" + window.location.host + \"/Files/resourceDownload\";\r\n                // window.open(url, '_blank');\r\n                // 基于base64的前端下载方式\r\n                const xhr = new XMLHttpRequest();\r\n                xhr.open('post', url);\r\n                xhr.responseType = 'blob';\r\n                xhr.setRequestHeader('Content-Type','application/json');\r\n                xhr.send(JSON.stringify({fileName:row.resourceName}));\r\n                xhr.onload = function () {\r\n                    if (this.status === 200 || this.status === 304) {\r\n                        const fileReader = new FileReader();\r\n                        fileReader.readAsDataURL(this.response);\r\n                        fileReader.onload = function () {\r\n                            const a = document.createElement('a');\r\n                            a.style.display = 'none';\r\n                            a.href = this.result;\r\n                            a.download = row.resourceName;\r\n                            document.body.appendChild(a);\r\n                            a.click();\r\n                            document.body.removeChild(a);\r\n                        };\r\n                    }\r\n                };\r\n                // 解决多弹窗重叠问题\r\n                setTimeout(()=>{this.$message.success(\"下载:\"+row.resourceName+\" 完成！\")},1000);\r\n                // 文件下载量增加\r\n                let resource = {resourceId:row.resourceId,downloadNum:row.downloadNum};\r\n                this.$axios.post(\"/Resource/downloadNumAdd\",resource).then(resp=>{\r\n                    if(resp.data.flag){\r\n                        // 写入成功，刷新数据\r\n                        this.getFiles();\r\n                    }else{\r\n                        this.$message.error('删除失败！');\r\n                    }\r\n                })\r\n            },\r\n            //分页大小变化\r\n            handleSizeChange(val) {\r\n                this.filePageSize = val;\r\n                // 查询所有文件\r\n                this.getFiles();\r\n            },\r\n            // 当前页变化\r\n            handleCurrentChange(val) {\r\n                this.fileCurrentPage = val;\r\n                // 查询所有文件\r\n                this.getFiles();\r\n            }\r\n        },\r\n\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /* 文件上传框 */\r\n    ::v-deep .el-upload-dragger {\r\n        width: 500px;\r\n        height: 300px;\r\n    }\r\n    /* 表格文字大小 */\r\n    .el-table{\r\n        font-size: 17px;\r\n    }\r\n    /* 表格行高控制 */\r\n    ::v-deep .el-table .el-table__cell{\r\n        padding: 9px 0;\r\n    }\r\n    #pageBar{\r\n        margin-top: 20px;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}