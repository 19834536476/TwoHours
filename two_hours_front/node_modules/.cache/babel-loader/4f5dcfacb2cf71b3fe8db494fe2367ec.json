{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: \"courseTab\",\n  data: function data() {\n    return {\n      // 课程信息\n      course: {\n        coverImg: ''\n      },\n      courseDescribes: '',\n      // 图像适应\n      coverImgFit: 'cover',\n      // 上传图片路径\n      CoverImageUrl: '',\n      // 更新课程简介对话框\n      updateCourseInfoEditorShow: false,\n      updateCourseInfoEditorContent: ''\n    };\n  },\n  created: function created() {\n    this.getCourse();\n  },\n  methods: {\n    // 获取课程信息\n    getCourse: function getCourse() {\n      var _this = this;\n\n      this.$axios.get(\"/CourseView/getCourseInfo\").then(function (res) {\n        if (res.data.flag) {\n          // 保存用户数据\n          _this.course = res.data.data;\n          _this.courseDescribes = _this.course.describes;\n          _this.CoverImageUrl = _this.course.coverImg;\n        } else {\n          // 服务故障\n          _this.$message.error(\"数据拉取失败！\");\n\n          _this.$router.replace({\n            name: 'UserMainPage'\n          });\n        }\n      });\n    },\n    // 封面上传成功的钩子-回显并写入数据库\n    handleCourseCoverSuccess: function handleCourseCoverSuccess(res, file) {\n      // this.CoverImageUrl = URL.createObjectURL(file.raw);\n      // 删除旧图 todo :由于异步导致的无法及时判断数据库写入状态，故默认成功，但不排除可能失败\n      this.$axios.post(\"/Files/deleteCourseCoverImg\", this.course); // 写入图片路径\n\n      this.course.coverImg = res; // 更新课程数据\n\n      this.updateCourse();\n    },\n    // 更新课程数据\n    updateCourse: function updateCourse() {\n      var _this2 = this;\n\n      this.$axios.post(\"/Course/updateInfo\", this.course).then(function (res) {\n        if (res.data.flag) {\n          // 修改成功\n          _this2.$message.success(res.data.msg); // 子组件更新后父组件数据刷新\n\n\n          _this2.$emit(\"refresh\");\n\n          _this2.getCourse();\n        } else {\n          // 服务故障\n          _this2.$message.error(res.data.msg);\n        }\n      });\n    },\n    // 上传图片之前的钩子，参数为上传的文件，若返回 false 或者返回 Promise 且被 reject，则停止上传。\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isPNG = file.type === 'image/png';\n      var isLt40M = file.size / 1024 / 1024 < 40;\n\n      if (!isJPG && !isPNG) {\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\n      }\n\n      if (!isLt40M) {\n        this.$message.error('上传头像图片大小不能超过 40MB!');\n      }\n\n      return isJPG || isPNG && isLt40M;\n    },\n    // 课程状态修改\n    updateCourseState: function updateCourseState() {\n      // 更新状态\n      this.course.isPublic = this.course.isPublicBool ? 1 : 0;\n      this.updateCourse();\n    },\n    // 编辑课程简介\n    updateCourseInfo: function updateCourseInfo(courseDescribes) {\n      this.updateCourseInfoEditorShow = true;\n      this.updateCourseInfoEditorContent = courseDescribes;\n    },\n    // 保存编辑\n    saveCourseInfo: function saveCourseInfo() {\n      var _this3 = this;\n\n      // 数据绑定\n      this.course.describes = this.updateCourseInfoEditorContent; // 保存到数据库\n\n      this.$axios.post(\"/Course/updateInfo\", this.course).then(function (res) {\n        if (res.data.flag) {\n          // 修改成功\n          _this3.$message.success(res.data.msg); // 刷新课程数据\n\n\n          _this3.getCourse(); // 关闭编辑窗口\n\n\n          _this3.updateCourseInfoEditorShow = false;\n        } else {\n          // 服务故障-回滚数据\n          _this3.course.describes = _this3.courseDescribes;\n\n          _this3.$message.error(res.data.msg);\n\n          return false;\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA;AACAA,mBADA;AAEAC,MAFA,kBAEA;AACA;AACA;AACAC;AACAC;AADA,OAFA;AAKAC,yBALA;AAMA;AACAC,0BAPA;AAQA;AACAC,uBATA;AAUA;AACAC,uCAXA;AAYAC;AAZA;AAcA,GAjBA;AAkBAC,SAlBA,qBAkBA;AACA;AACA,GApBA;AAqBAC;AACA;AACAC,aAFA,uBAEA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;;AACA;AACAX;AADA;AAGA;AACA,OAbA;AAcA,KAjBA;AAkBA;AACAY,4BAnBA,oCAmBAC,GAnBA,EAmBAC,IAnBA,EAmBA;AACA;AACA;AACA,mEAHA,CAIA;;AACA,iCALA,CAMA;;AACA;AACA,KA3BA;AA4BA;AACAC,gBA7BA,0BA6BA;AAAA;;AACA;AACA;AACA;AACA,gDAFA,CAGA;;;AACA;;AACA;AACA,SANA,MAMA;AACA;AACA;AACA;AACA,OAXA;AAYA,KA1CA;AA2CA;AACAC,sBA5CA,8BA4CAF,IA5CA,EA4CA;AACA;AACA;AAEA;;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA,KAxDA;AAyDA;AACAG,qBA1DA,+BA0DA;AACA;AACA;AACA;AACA,KA9DA;AA+DA;AACAC,oBAhEA,4BAgEAd,eAhEA,EAgEA;AACA;AACA;AACA,KAnEA;AAoEA;AACAe,kBArEA,4BAqEA;AAAA;;AACA;AACA,iEAFA,CAGA;;AACA;AACA;AACA;AACA,gDAFA,CAGA;;;AACA,6BAJA,CAKA;;;AACA;AACA,SAPA,MAOA;AACA;AACA;;AACA;;AACA;AACA;AACA,OAdA;AAeA;AAxFA;AArBA","names":["name","data","course","coverImg","courseDescribes","coverImgFit","CoverImageUrl","updateCourseInfoEditorShow","updateCourseInfoEditorContent","created","methods","getCourse","handleCourseCoverSuccess","res","file","updateCourse","beforeAvatarUpload","updateCourseState","updateCourseInfo","saveCourseInfo"],"sourceRoot":"src/pages/user/teacherComponents","sources":["CourseTab.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-row>\r\n            <!-- 封面 -->\r\n            <el-col :span=\"8\" style=\"position: relative; margin-top: 100px\">\r\n                <!-- 封面上传 -->\r\n                <el-upload\r\n                        id=\"courseCoverUploader\"\r\n                        action=\"/Files/courseCoverUpload\"\r\n                        :show-file-list=\"false\"\r\n                        :on-success=\"handleCourseCoverSuccess\"\r\n                        :before-upload=\"beforeAvatarUpload\">\r\n                    <!-- 此处设置有默认封面 -->\r\n                    <el-image v-if=\"CoverImageUrl\" :src=\"CoverImageUrl\" :fit=\"coverImgFit\" id=\"courseCoverImage\"></el-image>\r\n                    <i class=\"el-icon-plus uploader-icons\">上传封面</i>\r\n                </el-upload>\r\n            </el-col>\r\n            <!-- 标题 -->\r\n            <el-col :span=\"12\" style=\"position: relative; left: 12%\">\r\n                <!-- 标题 -->\r\n                <div id=\"courseName_Manager\">{{ course.courseName }}</div>\r\n                <!-- 创建时间和标签 -->\r\n                <div id=\"courseCreateTimeAndTags_Manager\">\r\n                    <div style=\"text-align: center;margin-bottom: 5px\">创建时间：{{ course.formatDateShort }}</div>\r\n                    <span>\r\n                        {{course.isPublicStr}}：\r\n                        <el-tooltip :content=\"course.isPublicBool?'公开课程任何人都能加入':'私有课程任何人都无法加入'\" placement=\"top\">\r\n                            <el-switch v-model=\"course.isPublicBool\" @change=\"updateCourseState\"></el-switch>\r\n                        </el-tooltip>\r\n                    </span>\r\n                    <span style=\"margin-left: 20px\">\r\n                        {{course.isStartStr}}：\r\n                         <el-tooltip :content=\"course.isStartBool?'课程已开启':'请等待管理员审核'\" placement=\"top\">\r\n                            <el-switch disabled active-color=\"#13ce66\" v-model=\"course.isStartBool\"></el-switch>\r\n                         </el-tooltip>\r\n                    </span>\r\n                </div>\r\n                <el-divider id=\"infoDivider\"></el-divider>\r\n                <!-- 简介 -->\r\n                <div id=\"courseDescribes_Manager\">\r\n                    <div style=\"margin-top: 20px\">简介：{{ courseDescribes }}</div>\r\n                </div>\r\n                <!-- 编辑按钮 -->\r\n                <div id=\"editCourseInfoButton\">\r\n                    <el-button type=\"text\" style=\"font-size: 16px\" @click=\"updateCourseInfo(courseDescribes)\">编辑简介</el-button>\r\n                </div>\r\n            </el-col>\r\n        </el-row>\r\n        <!-- 编辑区 -->\r\n        <el-dialog\r\n                title=\"编辑简介\"\r\n                :visible.sync=\"updateCourseInfoEditorShow\"\r\n                width=\"50%\"\r\n                id=\"updateCourseInfoEditor\">\r\n            <el-input\r\n                    id=\"updateCourseInfoEditorTags\"\r\n                    type=\"textarea\"\r\n                    placeholder=\"请输入内容\"\r\n                    v-model=\"updateCourseInfoEditorContent\"\r\n                    maxlength=\"240\"\r\n                    show-word-limit>\r\n            </el-input>\r\n            <el-button type=\"text\"\r\n                       style=\"font-size: 16px;margin-top: 15px\"\r\n                       @click=\"saveCourseInfo\">\r\n                保存编辑\r\n            </el-button>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        name: \"courseTab\",\r\n        data(){\r\n            return{\r\n                // 课程信息\r\n                course:{\r\n                    coverImg:'',\r\n                },\r\n                courseDescribes: '',\r\n                // 图像适应\r\n                coverImgFit:'cover',\r\n                // 上传图片路径\r\n                CoverImageUrl:'',\r\n                // 更新课程简介对话框\r\n                updateCourseInfoEditorShow:false,\r\n                updateCourseInfoEditorContent:'',\r\n            }\r\n        },\r\n        created() {\r\n           this.getCourse();\r\n        },\r\n        methods:{\r\n            // 获取课程信息\r\n            getCourse(){\r\n                this.$axios.get(\"/CourseView/getCourseInfo\").then((res)=>{\r\n                    if(res.data.flag){\r\n                        // 保存用户数据\r\n                        this.course = res.data.data;\r\n                        this.courseDescribes = this.course.describes;\r\n                        this.CoverImageUrl = this.course.coverImg;\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"数据拉取失败！\");\r\n                        this.$router.replace({\r\n                            name:'UserMainPage'\r\n                        })\r\n                    }\r\n                });\r\n            },\r\n            // 封面上传成功的钩子-回显并写入数据库\r\n            handleCourseCoverSuccess(res, file) {\r\n                // this.CoverImageUrl = URL.createObjectURL(file.raw);\r\n                // 删除旧图 todo :由于异步导致的无法及时判断数据库写入状态，故默认成功，但不排除可能失败\r\n                this.$axios.post(\"/Files/deleteCourseCoverImg\",this.course);\r\n                // 写入图片路径\r\n                this.course.coverImg = res;\r\n                // 更新课程数据\r\n                this.updateCourse();\r\n            },\r\n            // 更新课程数据\r\n            updateCourse(){\r\n                this.$axios.post(\"/Course/updateInfo\",this.course).then((res)=>{\r\n                    if(res.data.flag){\r\n                        // 修改成功\r\n                        this.$message.success(res.data.msg);\r\n                        // 子组件更新后父组件数据刷新\r\n                        this.$emit(\"refresh\");\r\n                        this.getCourse();\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(res.data.msg);\r\n                    }\r\n                });\r\n            },\r\n            // 上传图片之前的钩子，参数为上传的文件，若返回 false 或者返回 Promise 且被 reject，则停止上传。\r\n            beforeAvatarUpload(file) {\r\n                const isJPG = file.type === ('image/jpeg');\r\n                const isPNG = file.type === ('image/png');\r\n\r\n                const isLt40M = file.size / 1024 / 1024 < 40;\r\n                if (!isJPG && !isPNG) {\r\n                    this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n                }\r\n                if (!isLt40M) {\r\n                    this.$message.error('上传头像图片大小不能超过 40MB!');\r\n                }\r\n                return isJPG||isPNG && isLt40M;\r\n            },\r\n            // 课程状态修改\r\n            updateCourseState(){\r\n                // 更新状态\r\n                this.course.isPublic = this.course.isPublicBool ? 1:0;\r\n                this.updateCourse();\r\n            },\r\n            // 编辑课程简介\r\n            updateCourseInfo(courseDescribes){\r\n                this.updateCourseInfoEditorShow = true;\r\n                this.updateCourseInfoEditorContent = courseDescribes;\r\n            },\r\n            // 保存编辑\r\n            saveCourseInfo(){\r\n                // 数据绑定\r\n                this.course.describes = this.updateCourseInfoEditorContent;\r\n                // 保存到数据库\r\n                this.$axios.post(\"/Course/updateInfo\",this.course).then((res)=>{\r\n                    if(res.data.flag){\r\n                        // 修改成功\r\n                        this.$message.success(res.data.msg);\r\n                        // 刷新课程数据\r\n                        this.getCourse();\r\n                        // 关闭编辑窗口\r\n                        this.updateCourseInfoEditorShow=false;\r\n                    }else{\r\n                        // 服务故障-回滚数据\r\n                        this.course.describes = this.courseDescribes;\r\n                        this.$message.error(res.data.msg);\r\n                        return false;\r\n                    }\r\n                });\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /**\r\n    * 课程管理区\r\n    */\r\n    /* 封面修改 */\r\n    #courseCoverUploader{\r\n        border: 1px dashed #a7a7a7;\r\n        border-radius: 6px; /* 圆角 */\r\n        cursor: pointer;    /* 鼠标样式 */\r\n        left: 18%;\r\n        position: relative;\r\n        overflow: hidden;   /* 隐藏滚动 */\r\n        height: 300px;\r\n    }\r\n    /* 封面图 */\r\n    ::v-deep #courseCoverImage{\r\n        width: 540px;\r\n        height: 300px;\r\n    }\r\n    /* 边框高亮显示 */\r\n    #courseCoverUploader:hover {\r\n        border-color: #409EFF;\r\n    }\r\n    /* 上传文字 */\r\n    .uploader-icons {\r\n        font-size: 20px;\r\n        font-family: \"微软雅黑\";\r\n        color: #dfe1e1;\r\n        /* 定位 */\r\n        top: 45%;\r\n        left: 40%;\r\n        position: absolute;\r\n        z-index: 5;\r\n    }\r\n    /* 课程名称 */\r\n    #courseName_Manager{\r\n        /* 定位 */\r\n        position: absolute;\r\n        top: 100px;\r\n        left: 40%;\r\n        /* 字体样式 */\r\n        font-size: 30px;\r\n        font-family: \"等线\";\r\n        font-weight: 600;\r\n        /* 边框大小 */\r\n        margin-left: 10px;\r\n        margin-top: 10px;\r\n        text-align: center;\r\n    }\r\n    /* 创建时间 */\r\n    #courseCreateTimeAndTags_Manager{\r\n        /* 定位 */\r\n        position: absolute;\r\n        left: 34%;\r\n        top: 150px;\r\n        /* 字体样式 */\r\n        font-size: 21px;\r\n        font-family: \"微软雅黑\";\r\n        font-weight: 400;\r\n        color: #8c939d;\r\n        margin-top: 5px;\r\n    }\r\n    /* 分界线 */\r\n    #infoDivider{\r\n        left: -5%;\r\n        width:110%;\r\n        position: absolute;\r\n        top: 225px;\r\n    }\r\n    /* 简介 */\r\n    #courseDescribes_Manager{\r\n        /* 定位 */\r\n        position: absolute;\r\n        left: 5%;\r\n        top: 230px;\r\n        /* 字体样式 */\r\n        font-size: 25px;\r\n        font-family: \"微软雅黑\";\r\n        font-weight: 400;\r\n        color: #000000;\r\n        /* 形式 */\r\n        text-align: left;\r\n        text-indent: 2em;\r\n    }\r\n    /* 简介编辑按钮 */\r\n    #editCourseInfoButton{\r\n        position: absolute;\r\n        left: 91%;\r\n        top: 600px;\r\n    }\r\n    /* 编辑简介对话框 */\r\n    #updateCourseInfoEditor{\r\n        /*margin-top: 150px;*/\r\n    }\r\n    /* 编辑提示 */\r\n    ::v-deep #updateCourseInfoEditorTags{\r\n        font-size: 18px;\r\n        color: #000000;\r\n        height: 200px;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}