{"ast":null,"code":"import \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar MiniMap =\n/** @class */\nfunction () {\n  function MiniMap(_a) {\n    var _this = this;\n\n    var lf = _a.lf,\n        LogicFlow = _a.LogicFlow;\n    this.__lf = null;\n    this.__container = null;\n    this.__miniMapWrap = null;\n    this.__miniMapContainer = null;\n    this.__lfMap = null;\n    this.__viewport = null;\n    this.__width = 150;\n    this.__height = 220;\n    this.__miniMapWidth = 450;\n    this.__miniMapHeight = 660;\n    this.__viewPortTop = 0;\n    this.__viewPortLeft = 0;\n    this.__startPosition = null;\n    this.__viewPortScale = 1;\n    this.__viewPortWidth = 150;\n    this.__viewPortHeight = 75;\n    this.__resetDataX = 0;\n    this.__resetDataY = 0;\n    this.__LogicFlow = null;\n    this.__isShow = false;\n    this.__disabledPlugins = ['miniMap', 'control', 'selectionSelect'];\n    /**\n     * 显示mini map\n     */\n\n    this.show = function (leftPosition, topPosition) {\n      _this.__setView();\n\n      if (!_this.__isShow) {\n        _this.__createMiniMap(leftPosition, topPosition);\n      }\n\n      _this.__isShow = true;\n    };\n    /**\n     * 隐藏mini map\n     */\n\n\n    this.hide = function () {\n      if (_this.__isShow) {\n        _this.__removeMiniMap();\n      }\n\n      _this.__isShow = false;\n    };\n\n    this.__startDrag = function (e) {\n      document.addEventListener('mousemove', _this.__drag);\n      document.addEventListener('mouseup', _this.__drop);\n      _this.__startPosition = {\n        x: e.x,\n        y: e.y\n      };\n    };\n\n    this.__drag = function (e) {\n      var viewStyle = _this.__viewport.style;\n      _this.__viewPortTop += e.y - _this.__startPosition.y;\n      _this.__viewPortLeft += e.x - _this.__startPosition.x;\n      viewStyle.top = _this.__viewPortTop + \"px\";\n      viewStyle.left = _this.__viewPortLeft + \"px\";\n      _this.__startPosition = {\n        x: e.x,\n        y: e.y\n      };\n      var centerX = (_this.__viewPortLeft + _this.__viewPortWidth / 2) / _this.__viewPortScale;\n      var centerY = (_this.__viewPortTop + _this.__viewPortHeight / 2) / _this.__viewPortScale;\n\n      _this.__lf.focusOn({\n        coordinate: {\n          x: centerX + _this.__resetDataX,\n          y: centerY + _this.__resetDataY\n        }\n      });\n    };\n\n    this.__drop = function () {\n      document.removeEventListener('mousemove', _this.__drag);\n      document.removeEventListener('mouseup', _this.__drop);\n    };\n\n    this.__lf = lf;\n    this.__miniMapWidth = lf.graphModel.width;\n    this.__miniMapHeight = lf.graphModel.width * 220 / 150;\n    this.__LogicFlow = LogicFlow;\n\n    this.__init();\n  }\n\n  MiniMap.prototype.render = function (lf, container) {\n    var _this = this;\n\n    this.__container = container;\n\n    this.__lf.on('history:change', function () {\n      if (_this.__isShow) {\n        _this.__setView();\n      }\n    });\n\n    this.__lf.on('blank:drop', function () {\n      if (_this.__isShow) {\n        _this.__setView();\n      }\n    });\n  };\n\n  MiniMap.prototype.init = function (option) {\n    this.__disabledPlugins = this.__disabledPlugins.concat(option.disabledPlugins || []);\n  };\n\n  MiniMap.prototype.__init = function () {\n    var miniMapWrap = document.createElement('div');\n    miniMapWrap.className = 'lf-mini-map-graph';\n    miniMapWrap.style.width = this.__width + \"px\";\n    miniMapWrap.style.height = this.__height + \"px\";\n    this.__lfMap = new this.__LogicFlow({\n      width: this.__lf.graphModel.width,\n      height: this.__lf.graphModel.width * 220 / 150,\n      container: miniMapWrap,\n      isSilentMode: true,\n      stopZoomGraph: true,\n      stopScrollGraph: true,\n      stopMoveGraph: true,\n      hideAnchors: true,\n      hoverOutline: false,\n      disabledPlugins: this.__disabledPlugins\n    }); // minimap中禁用adapter。\n\n    this.__lfMap.adapterIn = function (a) {\n      return a;\n    };\n\n    this.__lfMap.adapterOut = function (a) {\n      return a;\n    };\n\n    this.__miniMapWrap = miniMapWrap;\n\n    this.__createViewPort();\n  };\n\n  MiniMap.prototype.__createMiniMap = function (left, top) {\n    var miniMapContainer = document.createElement('div');\n    var miniMapWrap = this.__miniMapWrap;\n    miniMapContainer.appendChild(miniMapWrap);\n\n    if (typeof left !== 'undefined' && typeof top !== 'undefined') {\n      miniMapContainer.style.left = left + \"px\";\n      miniMapContainer.style.top = top + \"px\";\n    }\n\n    miniMapContainer.style.position = 'absolute';\n    miniMapContainer.className = 'lf-mini-map';\n\n    this.__container.appendChild(miniMapContainer);\n\n    this.__miniMapWrap.appendChild(this.__viewport);\n\n    var header = document.createElement('div');\n    header.className = 'lf-mini-map-header';\n    header.innerText = '导航';\n    miniMapContainer.appendChild(header);\n    var close = document.createElement('span');\n    close.className = 'lf-mini-map-close';\n    close.addEventListener('click', this.hide);\n    miniMapContainer.appendChild(close);\n    this.__miniMapContainer = miniMapContainer;\n  };\n\n  MiniMap.prototype.__removeMiniMap = function () {\n    this.__container.removeChild(this.__miniMapContainer);\n  };\n  /**\n   * 计算所有图形一起，占领的区域范围。\n   * @param data\n   */\n\n\n  MiniMap.prototype.__getBounds = function (data) {\n    var left = 0;\n    var right = this.__miniMapWidth;\n    var top = 0;\n    var bottom = this.__miniMapHeight;\n    var nodes = data.nodes;\n\n    if (nodes && nodes.length > 0) {\n      // 因为获取的节点不知道真实的宽高，这里需要补充一点数值\n      nodes.forEach(function (_a) {\n        var x = _a.x,\n            y = _a.y,\n            _b = _a.width,\n            width = _b === void 0 ? 200 : _b,\n            _c = _a.height,\n            height = _c === void 0 ? 200 : _c;\n        var nodeLeft = x - width / 2;\n        var noderight = x + width / 2;\n        var nodeTop = y - height / 2;\n        var nodeBottom = y + height / 2;\n        left = nodeLeft < left ? nodeLeft : left;\n        right = noderight > right ? noderight : right;\n        top = nodeTop < top ? nodeTop : top;\n        bottom = nodeBottom > bottom ? nodeBottom : bottom;\n      });\n    }\n\n    return {\n      left: left,\n      top: top,\n      bottom: bottom,\n      right: right\n    };\n  };\n  /**\n   * 将负值的平移转换为正值。\n   * 保证渲染的时候，minimap能完全展示。\n   * 获取将画布所有元素平移到0，0开始时，所有节点数据\n   */\n\n\n  MiniMap.prototype.__resetData = function (data) {\n    var nodes = data.nodes,\n        edges = data.edges;\n    var left = 0;\n    var top = 0;\n\n    if (nodes && nodes.length > 0) {\n      // 因为获取的节点不知道真实的宽高，这里需要补充一点数值\n      nodes.forEach(function (_a) {\n        var x = _a.x,\n            y = _a.y,\n            _b = _a.width,\n            width = _b === void 0 ? 200 : _b,\n            _c = _a.height,\n            height = _c === void 0 ? 200 : _c;\n        var nodeLeft = x - width / 2;\n        var nodeTop = y - height / 2;\n        left = nodeLeft < left ? nodeLeft : left;\n        top = nodeTop < top ? nodeTop : top;\n      });\n\n      if (left < 0 || top < 0) {\n        this.__resetDataX = left;\n        this.__resetDataY = top;\n        nodes.forEach(function (node) {\n          node.x = node.x - left;\n          node.y = node.y - top;\n\n          if (node.text) {\n            node.text.x = node.text.x - left;\n            node.text.y = node.text.y - top;\n          }\n        });\n        edges.forEach(function (edge) {\n          if (edge.startPoint) {\n            edge.startPoint.x = edge.startPoint.x - left;\n            edge.startPoint.y = edge.startPoint.y - top;\n          }\n\n          if (edge.endPoint) {\n            edge.endPoint.x = edge.endPoint.x - left;\n            edge.endPoint.y = edge.endPoint.y - top;\n          }\n\n          if (edge.text) {\n            edge.text.x = edge.text.x - left;\n            edge.text.y = edge.text.y - top;\n          }\n\n          if (edge.pointsList) {\n            edge.pointsList.forEach(function (point) {\n              point.x = point.x - left;\n              point.y = point.y - top;\n            });\n          }\n        });\n      }\n    }\n\n    return data;\n  };\n  /**\n   * 显示导航\n   * 显示视口范围\n   * 1. 基于画布的范围比例，设置视口范围比例。宽度默认为导航宽度。\n   */\n\n\n  MiniMap.prototype.__setView = function () {\n    var e_1, _a; // 1. 获取到图中所有的节点中的位置，将其偏移到原点开始（避免节点位置为负的时候无法展示问题）。\n\n\n    var data = this.__resetData(this.__lf.getGraphRawData()); // 由于随时都会有新节点注册进来，需要同步将注册的\n\n\n    var viewMap = this.__lf.viewMap;\n    var modelMap = this.__lf.graphModel.modelMap;\n    var minimapViewMap = this.__lfMap.viewMap;\n\n    try {\n      // todo: no-restricted-syntax\n      for (var _b = __values(viewMap.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var key = _c.value;\n\n        if (!minimapViewMap.has(key)) {\n          this.__lfMap.setView(key, viewMap.get(key));\n\n          this.__lfMap.graphModel.modelMap.set(key, modelMap.get(key));\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    this.__lfMap.render(data); // 2. 将偏移后的数据渲染到minimap画布上\n    // 3. 计算出所有节点在一起的边界。\n\n\n    var _d = this.__getBounds(data),\n        left = _d.left,\n        top = _d.top,\n        right = _d.right,\n        bottom = _d.bottom; // 4. 计算所有节点的边界与minimap看板的边界的比例.\n\n\n    var realWidthScale = this.__width / (right - left);\n    var realHeightScale = this.__height / (bottom - top); // 5. 取比例最小的值，将渲染的画布缩小对应比例。\n\n    var innerStyle = this.__miniMapWrap.firstChild.style;\n    var scale = Math.min(realWidthScale, realHeightScale);\n    innerStyle.transform = \"matrix(\" + scale + \", 0, 0, \" + scale + \", 0, 0)\";\n    innerStyle.transformOrigin = 'left top';\n    innerStyle.height = bottom - Math.min(top, 0) + \"px\";\n    innerStyle.width = right - Math.min(left, 0) + \"px\";\n    this.__viewPortScale = scale;\n\n    this.__setViewPort(scale, {\n      left: left,\n      top: top,\n      right: right,\n      bottom: bottom\n    });\n  }; // 设置视口\n\n\n  MiniMap.prototype.__setViewPort = function (scale, _a) {\n    var left = _a.left,\n        right = _a.right,\n        top = _a.top,\n        bottom = _a.bottom;\n    var viewStyle = this.__viewport.style;\n    viewStyle.width = this.__width - 4 + \"px\";\n    viewStyle.height = (this.__width - 4) / (this.__lf.graphModel.width / this.__lf.graphModel.height) + \"px\"; // top\n\n    var _b = this.__lf.getTransform(),\n        TRANSLATE_X = _b.TRANSLATE_X,\n        TRANSLATE_Y = _b.TRANSLATE_Y;\n\n    var realWidth = right - left; // 视口实际宽 = 视口默认宽 / (所有元素一起占据的真实宽 / 绘布宽)\n\n    var realViewPortWidth = (this.__width - 4) / (realWidth / this.__lf.graphModel.width); // 视口实际高 = 视口实际宽 / (绘布宽 / 绘布高)\n\n    var graphRatio = this.__lf.graphModel.width / this.__lf.graphModel.height;\n    var realViewPortHeight = realViewPortWidth / graphRatio;\n    this.__viewPortTop = TRANSLATE_Y > 0 ? 0 : -TRANSLATE_Y * scale;\n    this.__viewPortLeft = -TRANSLATE_X * scale;\n    this.__viewPortWidth = realViewPortWidth;\n    this.__viewPortHeight = realViewPortHeight;\n    viewStyle.top = this.__viewPortTop + \"px\";\n    viewStyle.left = this.__viewPortLeft + \"px\";\n    viewStyle.width = realViewPortWidth + \"px\";\n    viewStyle.height = realViewPortHeight + \"px\";\n  }; // 预览视窗\n\n\n  MiniMap.prototype.__createViewPort = function () {\n    var div = document.createElement('div');\n    div.className = 'lf-minimap-viewport';\n    div.addEventListener('mousedown', this.__startDrag);\n    this.__viewport = div;\n  };\n\n  MiniMap.pluginName = 'miniMap';\n  return MiniMap;\n}();\n\nexport default MiniMap;\nexport { MiniMap };","map":{"version":3,"sources":["F:/Desktop/two_hours_front/node_modules/@logicflow/extension/es/components/mini-map/index.js"],"names":["__values","o","s","Symbol","iterator","m","i","call","length","next","value","done","TypeError","MiniMap","_a","_this","lf","LogicFlow","__lf","__container","__miniMapWrap","__miniMapContainer","__lfMap","__viewport","__width","__height","__miniMapWidth","__miniMapHeight","__viewPortTop","__viewPortLeft","__startPosition","__viewPortScale","__viewPortWidth","__viewPortHeight","__resetDataX","__resetDataY","__LogicFlow","__isShow","__disabledPlugins","show","leftPosition","topPosition","__setView","__createMiniMap","hide","__removeMiniMap","__startDrag","e","document","addEventListener","__drag","__drop","x","y","viewStyle","style","top","left","centerX","centerY","focusOn","coordinate","removeEventListener","graphModel","width","__init","prototype","render","container","on","init","option","concat","disabledPlugins","miniMapWrap","createElement","className","height","isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","hideAnchors","hoverOutline","adapterIn","a","adapterOut","__createViewPort","miniMapContainer","appendChild","position","header","innerText","close","removeChild","__getBounds","data","right","bottom","nodes","forEach","_b","_c","nodeLeft","noderight","nodeTop","nodeBottom","__resetData","edges","node","text","edge","startPoint","endPoint","pointsList","point","e_1","getGraphRawData","viewMap","modelMap","minimapViewMap","keys","key","has","setView","get","set","e_1_1","error","return","_d","realWidthScale","realHeightScale","innerStyle","firstChild","scale","Math","min","transform","transformOrigin","__setViewPort","getTransform","TRANSLATE_X","TRANSLATE_Y","realWidth","realViewPortWidth","graphRatio","realViewPortHeight","div","pluginName"],"mappings":"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","sourcesContent":["var __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar MiniMap = /** @class */ (function () {\n    function MiniMap(_a) {\n        var _this = this;\n        var lf = _a.lf, LogicFlow = _a.LogicFlow;\n        this.__lf = null;\n        this.__container = null;\n        this.__miniMapWrap = null;\n        this.__miniMapContainer = null;\n        this.__lfMap = null;\n        this.__viewport = null;\n        this.__width = 150;\n        this.__height = 220;\n        this.__miniMapWidth = 450;\n        this.__miniMapHeight = 660;\n        this.__viewPortTop = 0;\n        this.__viewPortLeft = 0;\n        this.__startPosition = null;\n        this.__viewPortScale = 1;\n        this.__viewPortWidth = 150;\n        this.__viewPortHeight = 75;\n        this.__resetDataX = 0;\n        this.__resetDataY = 0;\n        this.__LogicFlow = null;\n        this.__isShow = false;\n        this.__disabledPlugins = ['miniMap', 'control', 'selectionSelect'];\n        /**\n         * 显示mini map\n         */\n        this.show = function (leftPosition, topPosition) {\n            _this.__setView();\n            if (!_this.__isShow) {\n                _this.__createMiniMap(leftPosition, topPosition);\n            }\n            _this.__isShow = true;\n        };\n        /**\n         * 隐藏mini map\n         */\n        this.hide = function () {\n            if (_this.__isShow) {\n                _this.__removeMiniMap();\n            }\n            _this.__isShow = false;\n        };\n        this.__startDrag = function (e) {\n            document.addEventListener('mousemove', _this.__drag);\n            document.addEventListener('mouseup', _this.__drop);\n            _this.__startPosition = {\n                x: e.x,\n                y: e.y,\n            };\n        };\n        this.__drag = function (e) {\n            var viewStyle = _this.__viewport.style;\n            _this.__viewPortTop += e.y - _this.__startPosition.y;\n            _this.__viewPortLeft += e.x - _this.__startPosition.x;\n            viewStyle.top = _this.__viewPortTop + \"px\";\n            viewStyle.left = _this.__viewPortLeft + \"px\";\n            _this.__startPosition = {\n                x: e.x,\n                y: e.y,\n            };\n            var centerX = (_this.__viewPortLeft + _this.__viewPortWidth / 2)\n                / _this.__viewPortScale;\n            var centerY = (_this.__viewPortTop + _this.__viewPortHeight / 2)\n                / _this.__viewPortScale;\n            _this.__lf.focusOn({\n                coordinate: {\n                    x: centerX + _this.__resetDataX,\n                    y: centerY + _this.__resetDataY,\n                },\n            });\n        };\n        this.__drop = function () {\n            document.removeEventListener('mousemove', _this.__drag);\n            document.removeEventListener('mouseup', _this.__drop);\n        };\n        this.__lf = lf;\n        this.__miniMapWidth = lf.graphModel.width;\n        this.__miniMapHeight = (lf.graphModel.width * 220) / 150;\n        this.__LogicFlow = LogicFlow;\n        this.__init();\n    }\n    MiniMap.prototype.render = function (lf, container) {\n        var _this = this;\n        this.__container = container;\n        this.__lf.on('history:change', function () {\n            if (_this.__isShow) {\n                _this.__setView();\n            }\n        });\n        this.__lf.on('blank:drop', function () {\n            if (_this.__isShow) {\n                _this.__setView();\n            }\n        });\n    };\n    MiniMap.prototype.init = function (option) {\n        this.__disabledPlugins = this.__disabledPlugins.concat(option.disabledPlugins || []);\n    };\n    MiniMap.prototype.__init = function () {\n        var miniMapWrap = document.createElement('div');\n        miniMapWrap.className = 'lf-mini-map-graph';\n        miniMapWrap.style.width = this.__width + \"px\";\n        miniMapWrap.style.height = this.__height + \"px\";\n        this.__lfMap = new this.__LogicFlow({\n            width: this.__lf.graphModel.width,\n            height: (this.__lf.graphModel.width * 220) / 150,\n            container: miniMapWrap,\n            isSilentMode: true,\n            stopZoomGraph: true,\n            stopScrollGraph: true,\n            stopMoveGraph: true,\n            hideAnchors: true,\n            hoverOutline: false,\n            disabledPlugins: this.__disabledPlugins,\n        });\n        // minimap中禁用adapter。\n        this.__lfMap.adapterIn = function (a) { return a; };\n        this.__lfMap.adapterOut = function (a) { return a; };\n        this.__miniMapWrap = miniMapWrap;\n        this.__createViewPort();\n    };\n    MiniMap.prototype.__createMiniMap = function (left, top) {\n        var miniMapContainer = document.createElement('div');\n        var miniMapWrap = this.__miniMapWrap;\n        miniMapContainer.appendChild(miniMapWrap);\n        if (typeof left !== 'undefined' && typeof top !== 'undefined') {\n            miniMapContainer.style.left = left + \"px\";\n            miniMapContainer.style.top = top + \"px\";\n        }\n        miniMapContainer.style.position = 'absolute';\n        miniMapContainer.className = 'lf-mini-map';\n        this.__container.appendChild(miniMapContainer);\n        this.__miniMapWrap.appendChild(this.__viewport);\n        var header = document.createElement('div');\n        header.className = 'lf-mini-map-header';\n        header.innerText = '导航';\n        miniMapContainer.appendChild(header);\n        var close = document.createElement('span');\n        close.className = 'lf-mini-map-close';\n        close.addEventListener('click', this.hide);\n        miniMapContainer.appendChild(close);\n        this.__miniMapContainer = miniMapContainer;\n    };\n    MiniMap.prototype.__removeMiniMap = function () {\n        this.__container.removeChild(this.__miniMapContainer);\n    };\n    /**\n     * 计算所有图形一起，占领的区域范围。\n     * @param data\n     */\n    MiniMap.prototype.__getBounds = function (data) {\n        var left = 0;\n        var right = this.__miniMapWidth;\n        var top = 0;\n        var bottom = this.__miniMapHeight;\n        var nodes = data.nodes;\n        if (nodes && nodes.length > 0) {\n            // 因为获取的节点不知道真实的宽高，这里需要补充一点数值\n            nodes.forEach(function (_a) {\n                var x = _a.x, y = _a.y, _b = _a.width, width = _b === void 0 ? 200 : _b, _c = _a.height, height = _c === void 0 ? 200 : _c;\n                var nodeLeft = x - width / 2;\n                var noderight = x + width / 2;\n                var nodeTop = y - height / 2;\n                var nodeBottom = y + height / 2;\n                left = nodeLeft < left ? nodeLeft : left;\n                right = noderight > right ? noderight : right;\n                top = nodeTop < top ? nodeTop : top;\n                bottom = nodeBottom > bottom ? nodeBottom : bottom;\n            });\n        }\n        return {\n            left: left,\n            top: top,\n            bottom: bottom,\n            right: right,\n        };\n    };\n    /**\n     * 将负值的平移转换为正值。\n     * 保证渲染的时候，minimap能完全展示。\n     * 获取将画布所有元素平移到0，0开始时，所有节点数据\n     */\n    MiniMap.prototype.__resetData = function (data) {\n        var nodes = data.nodes, edges = data.edges;\n        var left = 0;\n        var top = 0;\n        if (nodes && nodes.length > 0) {\n            // 因为获取的节点不知道真实的宽高，这里需要补充一点数值\n            nodes.forEach(function (_a) {\n                var x = _a.x, y = _a.y, _b = _a.width, width = _b === void 0 ? 200 : _b, _c = _a.height, height = _c === void 0 ? 200 : _c;\n                var nodeLeft = x - width / 2;\n                var nodeTop = y - height / 2;\n                left = nodeLeft < left ? nodeLeft : left;\n                top = nodeTop < top ? nodeTop : top;\n            });\n            if (left < 0 || top < 0) {\n                this.__resetDataX = left;\n                this.__resetDataY = top;\n                nodes.forEach(function (node) {\n                    node.x = node.x - left;\n                    node.y = node.y - top;\n                    if (node.text) {\n                        node.text.x = node.text.x - left;\n                        node.text.y = node.text.y - top;\n                    }\n                });\n                edges.forEach(function (edge) {\n                    if (edge.startPoint) {\n                        edge.startPoint.x = edge.startPoint.x - left;\n                        edge.startPoint.y = edge.startPoint.y - top;\n                    }\n                    if (edge.endPoint) {\n                        edge.endPoint.x = edge.endPoint.x - left;\n                        edge.endPoint.y = edge.endPoint.y - top;\n                    }\n                    if (edge.text) {\n                        edge.text.x = edge.text.x - left;\n                        edge.text.y = edge.text.y - top;\n                    }\n                    if (edge.pointsList) {\n                        edge.pointsList.forEach(function (point) {\n                            point.x = point.x - left;\n                            point.y = point.y - top;\n                        });\n                    }\n                });\n            }\n        }\n        return data;\n    };\n    /**\n     * 显示导航\n     * 显示视口范围\n     * 1. 基于画布的范围比例，设置视口范围比例。宽度默认为导航宽度。\n     */\n    MiniMap.prototype.__setView = function () {\n        var e_1, _a;\n        // 1. 获取到图中所有的节点中的位置，将其偏移到原点开始（避免节点位置为负的时候无法展示问题）。\n        var data = this.__resetData(this.__lf.getGraphRawData());\n        // 由于随时都会有新节点注册进来，需要同步将注册的\n        var viewMap = this.__lf.viewMap;\n        var modelMap = this.__lf.graphModel.modelMap;\n        var minimapViewMap = this.__lfMap.viewMap;\n        try {\n            // todo: no-restricted-syntax\n            for (var _b = __values(viewMap.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var key = _c.value;\n                if (!minimapViewMap.has(key)) {\n                    this.__lfMap.setView(key, viewMap.get(key));\n                    this.__lfMap.graphModel.modelMap.set(key, modelMap.get(key));\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        this.__lfMap.render(data);\n        // 2. 将偏移后的数据渲染到minimap画布上\n        // 3. 计算出所有节点在一起的边界。\n        var _d = this.__getBounds(data), left = _d.left, top = _d.top, right = _d.right, bottom = _d.bottom;\n        // 4. 计算所有节点的边界与minimap看板的边界的比例.\n        var realWidthScale = this.__width / (right - left);\n        var realHeightScale = this.__height / (bottom - top);\n        // 5. 取比例最小的值，将渲染的画布缩小对应比例。\n        var innerStyle = this.__miniMapWrap.firstChild.style;\n        var scale = Math.min(realWidthScale, realHeightScale);\n        innerStyle.transform = \"matrix(\" + scale + \", 0, 0, \" + scale + \", 0, 0)\";\n        innerStyle.transformOrigin = 'left top';\n        innerStyle.height = bottom - Math.min(top, 0) + \"px\";\n        innerStyle.width = right - Math.min(left, 0) + \"px\";\n        this.__viewPortScale = scale;\n        this.__setViewPort(scale, {\n            left: left,\n            top: top,\n            right: right,\n            bottom: bottom,\n        });\n    };\n    // 设置视口\n    MiniMap.prototype.__setViewPort = function (scale, _a) {\n        var left = _a.left, right = _a.right, top = _a.top, bottom = _a.bottom;\n        var viewStyle = this.__viewport.style;\n        viewStyle.width = this.__width - 4 + \"px\";\n        viewStyle.height = (this.__width - 4) / (this.__lf.graphModel.width / this.__lf.graphModel.height) + \"px\";\n        // top\n        var _b = this.__lf.getTransform(), TRANSLATE_X = _b.TRANSLATE_X, TRANSLATE_Y = _b.TRANSLATE_Y;\n        var realWidth = right - left;\n        // 视口实际宽 = 视口默认宽 / (所有元素一起占据的真实宽 / 绘布宽)\n        var realViewPortWidth = (this.__width - 4) / (realWidth / this.__lf.graphModel.width);\n        // 视口实际高 = 视口实际宽 / (绘布宽 / 绘布高)\n        var graphRatio = (this.__lf.graphModel.width / this.__lf.graphModel.height);\n        var realViewPortHeight = realViewPortWidth / graphRatio;\n        this.__viewPortTop = TRANSLATE_Y > 0 ? 0 : -TRANSLATE_Y * scale;\n        this.__viewPortLeft = -TRANSLATE_X * scale;\n        this.__viewPortWidth = realViewPortWidth;\n        this.__viewPortHeight = realViewPortHeight;\n        viewStyle.top = this.__viewPortTop + \"px\";\n        viewStyle.left = this.__viewPortLeft + \"px\";\n        viewStyle.width = realViewPortWidth + \"px\";\n        viewStyle.height = realViewPortHeight + \"px\";\n    };\n    // 预览视窗\n    MiniMap.prototype.__createViewPort = function () {\n        var div = document.createElement('div');\n        div.className = 'lf-minimap-viewport';\n        div.addEventListener('mousedown', this.__startDrag);\n        this.__viewport = div;\n    };\n    MiniMap.pluginName = 'miniMap';\n    return MiniMap;\n}());\nexport default MiniMap;\nexport { MiniMap };\n"]},"metadata":{},"sourceType":"module"}