{"ast":null,"code":"import \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.number.min-safe-integer.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.number.max-safe-integer.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.concat.js\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar COMMON_TYPE_KEY = 'menu-common';\nvar NEXT_X_DISTANCE = 200;\nvar NEXT_Y_DISTANCE = 100;\n\nvar ContextMenu =\n/** @class */\nfunction () {\n  function ContextMenu(_a) {\n    var _this = this;\n\n    var lf = _a.lf;\n    this.menuTypeMap = new Map();\n\n    this.listenDelete = function () {\n      _this.hideContextMenu();\n    };\n\n    this.lf = lf;\n    this.__menuDOM = document.createElement('div');\n    this.__menuDOM.className = 'lf-inner-context';\n    this.menuTypeMap.set(COMMON_TYPE_KEY, []);\n\n    this.lf.setContextMenuByType = function (type, menus) {\n      _this.setContextMenuByType(type, menus);\n    };\n\n    this.lf.setContextMenuItems = function (menus) {\n      _this.setContextMenuItems(menus);\n    };\n\n    this.lf.showContextMenu = function (data) {\n      _this.showContextMenu(data);\n    };\n\n    this.lf.hideContextMenu = function () {\n      _this.hideContextMenu();\n    };\n  }\n\n  ContextMenu.prototype.render = function (lf, container) {\n    var _this = this;\n\n    this.container = container;\n    lf.on('node:click', function (_a) {\n      var data = _a.data;\n      _this._activeData = data;\n\n      _this.createContextMenu();\n    });\n    lf.on('edge:click', function (_a) {\n      var data = _a.data; // 获取右上角坐标\n\n      _this._activeData = data;\n\n      _this.createContextMenu();\n    });\n    lf.on('blank:click', function () {\n      _this.hideContextMenu();\n    });\n  };\n\n  ContextMenu.prototype.setContextMenuByType = function (type, menus) {\n    this.menuTypeMap.set(type, menus);\n  };\n  /**\n   * 隐藏菜单\n   */\n\n\n  ContextMenu.prototype.hideContextMenu = function () {\n    this.__menuDOM.innerHTML = '';\n    this.__menuDOM.style.display = 'none';\n\n    if (this.isShow) {\n      this.container.removeChild(this.__menuDOM);\n    }\n\n    this.lf.off('node:delete,edge:delete,node:drag,graph:transform', this.listenDelete);\n    this.isShow = false;\n  };\n  /**\n   * 显示指定元素菜单\n   * @param data 节点id、节点类型、菜单位置\n   */\n\n\n  ContextMenu.prototype.showContextMenu = function (data) {\n    if (!data || !data.id) {\n      console.warn('请检查传入的参数');\n      return;\n    }\n\n    this._activeData = data;\n    this.createContextMenu();\n  };\n\n  ContextMenu.prototype.setContextMenuItems = function (menus) {\n    this.menuTypeMap.set(COMMON_TYPE_KEY, menus);\n  };\n  /**\n   * 获取新菜单位置\n   */\n\n\n  ContextMenu.prototype.getContextMenuPosition = function () {\n    var data = this._activeData;\n    var Model = this.lf.graphModel.getElement(data.id);\n\n    if (!Model) {\n      console.warn(\"\\u627E\\u4E0D\\u5230\\u5143\\u7D20\" + data.id);\n      return;\n    }\n\n    var x;\n    var y;\n\n    if (Model.BaseType === 'edge') {\n      x = Number.MIN_SAFE_INTEGER;\n      y = Number.MAX_SAFE_INTEGER;\n      var edgeData = Model.getData();\n      x = Math.max(edgeData.startPoint.x, x);\n      y = Math.min(edgeData.startPoint.y, y);\n      x = Math.max(edgeData.endPoint.x, x);\n      y = Math.min(edgeData.endPoint.y, y);\n\n      if (edgeData.pointsList) {\n        edgeData.pointsList.forEach(function (point) {\n          x = Math.max(point.x, x);\n          y = Math.min(point.y, y);\n        });\n      }\n    }\n\n    if (Model.BaseType === 'node') {\n      x = data.x + Model.width / 2;\n      y = data.y - Model.height / 2;\n    }\n\n    return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([x, y]);\n  };\n\n  ContextMenu.prototype.createContextMenu = function () {\n    var _this = this;\n\n    var isSilentMode = this.lf.options.isSilentMode; // 静默模式不显示菜单\n\n    if (isSilentMode) {\n      return;\n    }\n\n    var items = this.menuTypeMap.get(this._activeData.type) || [];\n    items = items.concat(this.menuTypeMap.get(COMMON_TYPE_KEY));\n    var menus = document.createDocumentFragment();\n    items.forEach(function (item) {\n      var menuItem = document.createElement('div');\n      menuItem.className = 'lf-context-item';\n      var img = document.createElement('img');\n      img.src = item.icon;\n      img.className = 'lf-context-img';\n\n      if (item.className) {\n        menuItem.className = menuItem.className + \" \" + item.className;\n      }\n\n      img.addEventListener('click', function () {\n        _this.hideContextMenu();\n\n        if (item.callback) {\n          item.callback(_this._activeData);\n        } else {\n          _this.addNode({\n            sourceId: _this._activeData.id,\n            x: _this._activeData.x,\n            y: _this._activeData.y,\n            properties: item.properties,\n            type: item.type\n          });\n        }\n      });\n      menuItem.appendChild(img);\n      menus.appendChild(menuItem);\n    });\n    this.__menuDOM.innerHTML = '';\n\n    this.__menuDOM.appendChild(menus);\n\n    this.showMenu();\n  };\n\n  ContextMenu.prototype.addNode = function (node, y) {\n    var isDeep = y !== undefined;\n\n    if (y === undefined) {\n      y = node.y;\n    }\n\n    var nodeModel = this.lf.getNodeModelById(node.sourceId);\n    var leftTopX = node.x - nodeModel.width + NEXT_X_DISTANCE;\n    var leftTopY = y - node.y / 2 - 20;\n    var rightBottomX = node.x + nodeModel.width + NEXT_X_DISTANCE;\n    var rightBottomY = y + node.y / 2 + 20;\n    var exsitElements = this.lf.getAreaElement([leftTopX, leftTopY], [rightBottomX, rightBottomY]);\n\n    if (exsitElements.length) {\n      y = y + NEXT_Y_DISTANCE;\n      this.addNode(node, y);\n      return;\n    }\n\n    var newNode = this.lf.addNode({\n      type: node.type,\n      x: node.x + 200,\n      y: y,\n      properties: node.properties\n    });\n    var startPoint;\n    var endPoint;\n\n    if (isDeep) {\n      startPoint = {\n        x: node.x,\n        y: node.y + nodeModel.height / 2\n      };\n      endPoint = {\n        x: newNode.x - newNode.width / 2,\n        y: newNode.y\n      };\n    }\n\n    this.lf.addEdge({\n      sourceNodeId: node.sourceId,\n      targetNodeId: newNode.id,\n      startPoint: startPoint,\n      endPoint: endPoint\n    });\n  };\n\n  ContextMenu.prototype.showMenu = function () {\n    var _a = __read(this.getContextMenuPosition(), 2),\n        x = _a[0],\n        y = _a[1];\n\n    this.__menuDOM.style.display = 'flex';\n    this.__menuDOM.style.top = y + \"px\";\n    this.__menuDOM.style.left = x + 10 + \"px\";\n    this.container.appendChild(this.__menuDOM); // 菜单显示的时候，监听删除，同时隐藏\n\n    !this.isShow && this.lf.on('node:delete,edge:delete,node:drag,graph:transform', this.listenDelete);\n    this.isShow = true;\n  };\n\n  ContextMenu.pluginName = 'contextMenu';\n  return ContextMenu;\n}();\n\nexport default ContextMenu;\nexport { ContextMenu };","map":{"version":3,"sources":["F:/Desktop/繁星教育/TH资料/two_hours_front/node_modules/@logicflow/extension/es/components/context-menu/index.js"],"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","COMMON_TYPE_KEY","NEXT_X_DISTANCE","NEXT_Y_DISTANCE","ContextMenu","_a","_this","lf","menuTypeMap","Map","listenDelete","hideContextMenu","__menuDOM","document","createElement","className","set","setContextMenuByType","type","menus","setContextMenuItems","showContextMenu","data","prototype","render","container","on","_activeData","createContextMenu","innerHTML","style","display","isShow","removeChild","off","id","console","warn","getContextMenuPosition","Model","graphModel","getElement","x","y","BaseType","Number","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","edgeData","getData","Math","max","startPoint","min","endPoint","pointsList","forEach","point","width","height","transformModel","CanvasPointToHtmlPoint","isSilentMode","options","items","get","concat","createDocumentFragment","item","menuItem","img","src","icon","addEventListener","callback","addNode","sourceId","properties","appendChild","showMenu","node","isDeep","undefined","nodeModel","getNodeModelById","leftTopX","leftTopY","rightBottomX","rightBottomY","exsitElements","getAreaElement","length","newNode","addEdge","sourceNodeId","targetNodeId","top","left","pluginName"],"mappings":"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","sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar COMMON_TYPE_KEY = 'menu-common';\nvar NEXT_X_DISTANCE = 200;\nvar NEXT_Y_DISTANCE = 100;\nvar ContextMenu = /** @class */ (function () {\n    function ContextMenu(_a) {\n        var _this = this;\n        var lf = _a.lf;\n        this.menuTypeMap = new Map();\n        this.listenDelete = function () {\n            _this.hideContextMenu();\n        };\n        this.lf = lf;\n        this.__menuDOM = document.createElement('div');\n        this.__menuDOM.className = 'lf-inner-context';\n        this.menuTypeMap.set(COMMON_TYPE_KEY, []);\n        this.lf.setContextMenuByType = function (type, menus) {\n            _this.setContextMenuByType(type, menus);\n        };\n        this.lf.setContextMenuItems = function (menus) {\n            _this.setContextMenuItems(menus);\n        };\n        this.lf.showContextMenu = function (data) {\n            _this.showContextMenu(data);\n        };\n        this.lf.hideContextMenu = function () {\n            _this.hideContextMenu();\n        };\n    }\n    ContextMenu.prototype.render = function (lf, container) {\n        var _this = this;\n        this.container = container;\n        lf.on('node:click', function (_a) {\n            var data = _a.data;\n            _this._activeData = data;\n            _this.createContextMenu();\n        });\n        lf.on('edge:click', function (_a) {\n            var data = _a.data;\n            // 获取右上角坐标\n            _this._activeData = data;\n            _this.createContextMenu();\n        });\n        lf.on('blank:click', function () {\n            _this.hideContextMenu();\n        });\n    };\n    ContextMenu.prototype.setContextMenuByType = function (type, menus) {\n        this.menuTypeMap.set(type, menus);\n    };\n    /**\n     * 隐藏菜单\n     */\n    ContextMenu.prototype.hideContextMenu = function () {\n        this.__menuDOM.innerHTML = '';\n        this.__menuDOM.style.display = 'none';\n        if (this.isShow) {\n            this.container.removeChild(this.__menuDOM);\n        }\n        this.lf.off('node:delete,edge:delete,node:drag,graph:transform', this.listenDelete);\n        this.isShow = false;\n    };\n    /**\n     * 显示指定元素菜单\n     * @param data 节点id、节点类型、菜单位置\n     */\n    ContextMenu.prototype.showContextMenu = function (data) {\n        if (!data || !data.id) {\n            console.warn('请检查传入的参数');\n            return;\n        }\n        this._activeData = data;\n        this.createContextMenu();\n    };\n    ContextMenu.prototype.setContextMenuItems = function (menus) {\n        this.menuTypeMap.set(COMMON_TYPE_KEY, menus);\n    };\n    /**\n     * 获取新菜单位置\n     */\n    ContextMenu.prototype.getContextMenuPosition = function () {\n        var data = this._activeData;\n        var Model = this.lf.graphModel.getElement(data.id);\n        if (!Model) {\n            console.warn(\"\\u627E\\u4E0D\\u5230\\u5143\\u7D20\" + data.id);\n            return;\n        }\n        var x;\n        var y;\n        if (Model.BaseType === 'edge') {\n            x = Number.MIN_SAFE_INTEGER;\n            y = Number.MAX_SAFE_INTEGER;\n            var edgeData = Model.getData();\n            x = Math.max(edgeData.startPoint.x, x);\n            y = Math.min(edgeData.startPoint.y, y);\n            x = Math.max(edgeData.endPoint.x, x);\n            y = Math.min(edgeData.endPoint.y, y);\n            if (edgeData.pointsList) {\n                edgeData.pointsList.forEach(function (point) {\n                    x = Math.max(point.x, x);\n                    y = Math.min(point.y, y);\n                });\n            }\n        }\n        if (Model.BaseType === 'node') {\n            x = data.x + Model.width / 2;\n            y = data.y - Model.height / 2;\n        }\n        return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([x, y]);\n    };\n    ContextMenu.prototype.createContextMenu = function () {\n        var _this = this;\n        var isSilentMode = this.lf.options.isSilentMode;\n        // 静默模式不显示菜单\n        if (isSilentMode) {\n            return;\n        }\n        var items = this.menuTypeMap.get(this._activeData.type) || [];\n        items = items.concat(this.menuTypeMap.get(COMMON_TYPE_KEY));\n        var menus = document.createDocumentFragment();\n        items.forEach(function (item) {\n            var menuItem = document.createElement('div');\n            menuItem.className = 'lf-context-item';\n            var img = document.createElement('img');\n            img.src = item.icon;\n            img.className = 'lf-context-img';\n            if (item.className) {\n                menuItem.className = menuItem.className + \" \" + item.className;\n            }\n            img.addEventListener('click', function () {\n                _this.hideContextMenu();\n                if (item.callback) {\n                    item.callback(_this._activeData);\n                }\n                else {\n                    _this.addNode({\n                        sourceId: _this._activeData.id,\n                        x: _this._activeData.x,\n                        y: _this._activeData.y,\n                        properties: item.properties,\n                        type: item.type,\n                    });\n                }\n            });\n            menuItem.appendChild(img);\n            menus.appendChild(menuItem);\n        });\n        this.__menuDOM.innerHTML = '';\n        this.__menuDOM.appendChild(menus);\n        this.showMenu();\n    };\n    ContextMenu.prototype.addNode = function (node, y) {\n        var isDeep = y !== undefined;\n        if (y === undefined) {\n            y = node.y;\n        }\n        var nodeModel = this.lf.getNodeModelById(node.sourceId);\n        var leftTopX = node.x - nodeModel.width + NEXT_X_DISTANCE;\n        var leftTopY = y - node.y / 2 - 20;\n        var rightBottomX = node.x + nodeModel.width + NEXT_X_DISTANCE;\n        var rightBottomY = y + node.y / 2 + 20;\n        var exsitElements = this.lf.getAreaElement([leftTopX, leftTopY], [rightBottomX, rightBottomY]);\n        if (exsitElements.length) {\n            y = y + NEXT_Y_DISTANCE;\n            this.addNode(node, y);\n            return;\n        }\n        var newNode = this.lf.addNode({\n            type: node.type,\n            x: node.x + 200,\n            y: y,\n            properties: node.properties,\n        });\n        var startPoint;\n        var endPoint;\n        if (isDeep) {\n            startPoint = {\n                x: node.x,\n                y: node.y + nodeModel.height / 2,\n            };\n            endPoint = {\n                x: newNode.x - newNode.width / 2,\n                y: newNode.y,\n            };\n        }\n        this.lf.addEdge({\n            sourceNodeId: node.sourceId,\n            targetNodeId: newNode.id,\n            startPoint: startPoint,\n            endPoint: endPoint,\n        });\n    };\n    ContextMenu.prototype.showMenu = function () {\n        var _a = __read(this.getContextMenuPosition(), 2), x = _a[0], y = _a[1];\n        this.__menuDOM.style.display = 'flex';\n        this.__menuDOM.style.top = y + \"px\";\n        this.__menuDOM.style.left = x + 10 + \"px\";\n        this.container.appendChild(this.__menuDOM);\n        // 菜单显示的时候，监听删除，同时隐藏\n        !this.isShow && this.lf.on('node:delete,edge:delete,node:drag,graph:transform', this.listenDelete);\n        this.isShow = true;\n    };\n    ContextMenu.pluginName = 'contextMenu';\n    return ContextMenu;\n}());\nexport default ContextMenu;\nexport { ContextMenu, };\n"]},"metadata":{},"sourceType":"module"}