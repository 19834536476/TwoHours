{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.function.name.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport SearchBox from \"@/components/SearchBox\";\nexport default {\n  name: 'ExperimentTab',\n  components: {\n    SearchBox: SearchBox\n  },\n  data: function data() {\n    return {\n      // 当前页码\n      currentPage: 1,\n      // 分页大小\n      pageSize: 10,\n      // 总页码数\n      totalCount: 1,\n      // 内置查询模型\n      searchTitle: {\n        title: ''\n      },\n      experimentEditDate: {\n        experimentId: undefined,\n        title: '',\n        fileName: ''\n      },\n      // 实验编辑对话框\n      dialogVisible: false,\n      // 上传文件显示\n      uploadShow: true,\n      // 编辑状态激活\n      isEditExperiment: false,\n      // 文件上传成功后显示文件名并隐藏上传组件\n      uploadFilename: '',\n      // 考试数据\n      experimentData: [],\n      // 旧文件名\n      filenameOld: '',\n      // 课程id\n      courseId: ''\n    };\n  },\n  created: function created() {\n    this.getExperiment();\n  },\n  methods: {\n    // 查询实验数据\n    getExperiment: function getExperiment() {\n      var _this = this;\n\n      this.searchTitle[\"pageSize\"] = this.pageSize;\n      this.searchTitle[\"currentPage\"] = this.currentPage;\n      this.$axios.post(\"/Experiment/getPageByCondition\", this.searchTitle).then(function (res) {\n        if (res.data.flag) {\n          /* 保存公告数据 */\n          _this.experimentData = res.data.data.records;\n          /* 保存分页数据 */\n\n          _this.totalCount = res.data.data.total;\n          _this.currentPage = res.data.data.current;\n          _this.pageSize = res.data.data.size;\n        } else {\n          // 服务故障\n          _this.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 提交搜索\n    searchExperiment: function searchExperiment(title) {\n      this.searchTitle.title = title;\n      this.getExperiment();\n    },\n    // 表格颜色控制\n    tableRowClassName: function tableRowClassName(_ref) {\n      var row = _ref.row,\n          rowIndex = _ref.rowIndex;\n\n      if (rowIndex % 4 === 1) {\n        return 'warning-row';\n      } else if (rowIndex % 4 === 3) {\n        return 'success-row';\n      }\n\n      return '';\n    },\n    // 当某行数据被点击 todo\n    rowClick: function rowClick(row, column) {\n      if (column.label === '操作') return; // 打开实验详情页面\n\n      this.$router.push({\n        name: 'ExperimentView',\n        params: {\n          experimentId: row.experimentId\n        }\n      });\n    },\n    // 创建实验\n    createExperiment: function createExperiment() {\n      // 显示上传框\n      this.uploadShow = true; // 重置数据\n\n      this.uploadFilename = '';\n      this.experimentEditDate.fileName = '';\n      this.experimentEditDate.title = '';\n      this.experimentEditDate.experimentId = undefined;\n      this.dialogVisible = true;\n    },\n    // 编辑实验\n    editRow: function editRow(row) {\n      // 显示上传框\n      this.uploadShow = true;\n      this.isEditExperiment = true; // 激活编辑状态\n      // 重置数据\n\n      this.uploadFilename = '';\n      this.filenameOld = row.fileName;\n      this.courseId = row.courseId;\n      this.experimentEditDate.fileName = row.fileName;\n      this.experimentEditDate.title = row.title;\n      this.experimentEditDate.experimentId = row.experimentId;\n      this.dialogVisible = true;\n    },\n    // 发布实验\n    saveEditExperiment: function saveEditExperiment() {\n      var _this2 = this;\n\n      if (this.experimentEditDate.title === \"\") {\n        this.$message.error(\"标题不能为空！\");\n        return 0;\n      }\n\n      if (this.isEditExperiment) {\n        this.$axios.post(\"/Experiment/updateExperiment\", this.experimentEditDate).then(function (res) {\n          if (res.data.flag) {\n            _this2.$message.success(res.data.msg);\n\n            _this2.getExperiment();\n\n            _this2.isEditExperiment = false; // 关闭编辑状态\n\n            _this2.dialogVisible = false; // 关闭编辑窗口\n\n            if (_this2.filenameOld !== _this2.experimentEditDate.fileName) {\n              // 文件更新-清理旧文件\n              var resource = {\n                resourceName: _this2.filenameOld,\n                courseId: _this2.courseId\n              };\n\n              _this2.$axios.post(\"/Files/resourceDelete\", resource);\n            }\n          } else {\n            _this2.$message.error(res.data.msg);\n          }\n        });\n      } else {\n        this.$axios.post(\"/Experiment/createExperiment\", this.experimentEditDate).then(function (res) {\n          if (res.data.flag) {\n            _this2.$message.success(res.data.msg);\n\n            _this2.getExperiment();\n\n            _this2.dialogVisible = false;\n          } else {\n            _this2.$message.error(res.data.msg);\n          }\n        });\n      }\n    },\n    // 删除实验\n    deleteRow: function deleteRow(row) {\n      var _this3 = this;\n\n      this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        console.log(row);\n\n        _this3.$axios.post(\"/Experiment/deleteOneById\", row).then(function (res) {\n          if (res.data.flag) {\n            // 根据路径删除本地文件\n            var resource = {\n              resourceName: row.fileName,\n              courseId: row.courseId\n            };\n\n            _this3.$axios.post(\"/Files/resourceDelete\", resource).then(function (resp) {\n              if (resp.data === true) {\n                _this3.$message.success('删除成功！');\n              } else {\n                _this3.$message.error('删除失败！');\n              }\n            });\n\n            _this3.getExperiment();\n          } else {\n            // 服务故障\n            _this3.$message.error(\"信息获取失败！\");\n          }\n        });\n      });\n    },\n    // 下载文件\n    downloadFile: function downloadFile(row) {\n      var _this4 = this;\n\n      var url = \"http://\" + window.location.host + \"/Files/resourceDownload\";\n      var xhr = new XMLHttpRequest();\n      xhr.open('post', url);\n      xhr.responseType = 'blob'; //3.5 请求头（POST请求时设置）\n\n      xhr.setRequestHeader('Content-Type', 'application/json'); // xhr.setRequestHeader(\"Content-type\",\"application/json;charset=UTF-8\");\n\n      xhr.send(JSON.stringify({\n        fileName: row.fileName\n      }));\n\n      xhr.onload = function () {\n        if (this.status === 200 || this.status === 304) {\n          var fileReader = new FileReader();\n          fileReader.readAsDataURL(this.response);\n\n          fileReader.onload = function () {\n            var a = document.createElement('a');\n            a.style.display = 'none';\n            a.href = this.result;\n            a.download = row.fileName;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n          };\n        }\n      }; // 解决多弹窗重叠问题\n\n\n      setTimeout(function () {\n        _this4.$message.success(\"下载:\" + row.fileName + \" 完成！\");\n      }, 1000);\n    },\n    // 文件上传成功的钩子-回显并写入数据\n    handleFileSuccess: function handleFileSuccess(res, file) {\n      if (res !== '') {\n        // 组织实验信息\n        this.experimentEditDate.fileName = res; // 关闭上传组件\n\n        this.uploadShow = false; // 回显文件名\n\n        this.uploadFilename = file.name;\n      } else {\n        this.$message.error(\"上传失败！\");\n      }\n    },\n    // 文件类型和大小检查\n    beforeFileUpload: function beforeFileUpload(file) {\n      var isLt10M = file.size / 1024 / 1024 < 10;\n\n      if (!isLt10M) {\n        this.$message.error('任务书大小不能超过 10MB!');\n      }\n\n      return isLt10M;\n    },\n    // 分页大小变化\n    handleSizeChange: function handleSizeChange(val) {\n      this.pageSize = val; // 查询所有实验\n\n      this.getExperiment();\n    },\n    // 当前页变化\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.currentPage = val; // 查询所有实验\n\n      this.getExperiment();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8HA;AACA;AACAA,uBADA;AAEAC;AACAC;AADA,GAFA;AAKAC,MALA,kBAKA;AACA;AACA;AACAC,oBAFA;AAGA;AACAC,kBAJA;AAKA;AACAC,mBANA;AAOA;AACAC;AACAC;AADA,OARA;AAWAC;AACAC,+BADA;AAEAF,iBAFA;AAGAG;AAHA,OAXA;AAgBA;AACAC,0BAjBA;AAkBA;AACAC,sBAnBA;AAoBA;AACAC,6BArBA;AAsBA;AACAC,wBAvBA;AAwBA;AACAC,wBAzBA;AA0BA;AACAC,qBA3BA;AA4BA;AACAC;AA7BA;AA+BA,GArCA;AAsCAC,SAtCA,qBAsCA;AACA;AACA,GAxCA;AAyCAC;AACA;AACAC,iBAFA,2BAEA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,SAPA,MAOA;AACA;AACA;AACA;AACA,OAZA;AAaA,KAlBA;AAmBA;AACAC,oBApBA,4BAoBAd,KApBA,EAoBA;AACA;AACA;AACA,KAvBA;AAwBA;AACAe,qBAzBA,mCAyBA;AAAA;AAAA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AACA;AACA,KAhCA;AAiCA;AACAC,YAlCA,oBAkCAC,GAlCA,EAkCAC,MAlCA,EAkCA;AACA,wCADA,CAEA;;AACA;AACA1B,8BADA;AAEA2B;AACAjB;AADA;AAFA;AAMA,KA3CA;AA4CA;AACAkB,oBA7CA,8BA6CA;AACA;AACA,6BAFA,CAGA;;AACA;AACA;AACA;AACA;AACA;AACA,KAtDA;AAuDA;AACAC,WAxDA,mBAwDAJ,GAxDA,EAwDA;AACA;AACA;AACA,mCAHA,CAGA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KApEA;AAqEA;AACAK,sBAtEA,gCAsEA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;;AACA,4CAHA,CAGA;;AACA,yCAJA,CAIA;;AACA;AACA;AACA;AACAC,gDADA;AAEAb;AAFA;;AAIA;AACA;AACA,WAbA,MAaA;AACA;AACA;AACA,SAjBA;AAkBA,OAnBA,MAmBA;AACA;AACA;AACA;;AACA;;AACA;AACA,WAJA,MAIA;AACA;AACA;AACA,SARA;AASA;AACA,KAzGA;AA0GA;AACAc,aA3GA,qBA2GAP,GA3GA,EA2GA;AAAA;;AACA;AACAQ,+BADA;AAEAC,8BAFA;AAGAC;AAHA,SAIAC,IAJA,CAIA;AACAC;;AACA;AACA;AACA;AACA;AACAN,wCADA;AAEAb;AAFA;;AAIA;AACA;AACA;AACA,eAFA,MAEA;AACA;AACA;AACA,aANA;;AAOA;AACA,WAdA,MAcA;AACA;AACA;AACA;AACA,SAnBA;AAoBA,OA1BA;AA2BA,KAvIA;AAwIA;AACAoB,gBAzIA,wBAyIAb,GAzIA,EAyIA;AAAA;;AACA;AACA;AACAc;AACAA,gCAJA,CAKA;;AACAA,+DANA,CAOA;;AACAA;AAAA5B;AAAA;;AACA4B;AACA;AACA;AACAC;;AACAA;AACA;AACAC;AACAA;AACAA;AACAC;AACAD;AACAC;AACA,WARA;AASA;AACA,OAdA,CATA,CAwBA;;;AACAC;AAAA;AAAA;AACA,KAnKA;AAoKA;AACAC,qBArKA,6BAqKAC,GArKA,EAqKAC,IArKA,EAqKA;AACA;AACA;AACA,+CAFA,CAGA;;AACA,gCAJA,CAKA;;AACA;AACA,OAPA,MAOA;AACA;AACA;AACA,KAhLA;AAiLA;AACAC,oBAlLA,4BAkLAD,IAlLA,EAkLA;AACA;;AACA;AACA;AACA;;AACA;AACA,KAxLA;AAyLA;AACAE,oBA1LA,4BA0LAC,GA1LA,EA0LA;AACA,0BADA,CAEA;;AACA;AACA,KA9LA;AA+LA;AACAC,uBAhMA,+BAgMAD,GAhMA,EAgMA;AACA,6BADA,CAEA;;AACA;AACA;AApMA;AAzCA","names":["name","components","SearchBox","data","currentPage","pageSize","totalCount","searchTitle","title","experimentEditDate","experimentId","fileName","dialogVisible","uploadShow","isEditExperiment","uploadFilename","experimentData","filenameOld","courseId","created","methods","getExperiment","searchExperiment","tableRowClassName","rowClick","row","column","params","createExperiment","editRow","saveEditExperiment","resourceName","deleteRow","confirmButtonText","cancelButtonText","type","then","console","downloadFile","xhr","fileReader","a","document","setTimeout","handleFileSuccess","res","file","beforeFileUpload","handleSizeChange","val","handleCurrentChange"],"sourceRoot":"src/pages/user/teacherComponents","sources":["ExperimentTab.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <!-- 功能菜单 -->\r\n        <el-row style=\"margin-top: 20px\">\r\n            <!--按钮-->\r\n            <el-col :span=\"6\">\r\n                <el-button type=\"primary\" plain @click=\"createExperiment\">新建实验</el-button>\r\n            </el-col>\r\n            <!--搜索表单-->\r\n            <el-col :span=\"7\" :offset=\"10\">\r\n                <search-box @onSubmit=\"searchExperiment\"></search-box>\r\n            </el-col>\r\n        </el-row>\r\n\r\n        <!--添加资料对话框表单-->\r\n        <el-dialog\r\n                title=\"编辑实验\"\r\n                :visible.sync=\"dialogVisible\"\r\n                width=\"40%\">\r\n            <!-- 输入标题-->\r\n            <div class=\"createChapterInfo\">输入标题</div>\r\n            <el-input\r\n                    id=\"updateCourseInfoEditorTags\"\r\n                    type=\"textarea\"\r\n                    v-model=\"experimentEditDate.title\"\r\n                    maxlength=\"60\"\r\n                    show-word-limit>\r\n            </el-input>\r\n            <div class=\"createChapterInfo\">上传任务书</div>\r\n            <!-- 资料上传 -->\r\n            <div style=\"width: 100%\">\r\n                <!-- 上传组件 -->\r\n                <el-upload\r\n                        drag\r\n                        multiple\r\n                        v-if=\"uploadShow\"\r\n                        width=\"80%\"\r\n                        :show-file-list=\"false\"\r\n                        action=\"/Files/resourceUpload\"\r\n                        :on-success=\"handleFileSuccess\"\r\n                        :before-upload=\"beforeFileUpload\">\r\n                    <i class=\"el-icon-upload\" style=\"margin-top: 15%\"></i>\r\n                    <div class=\"el-upload__text\" style=\"text-align: center\">将文件拖到此处，或<em>点击上传</em></div>\r\n                    <div class=\"el-upload__tip\" slot=\"tip\">文件大小不超过10MB</div>\r\n                </el-upload>\r\n                <!-- 文件名回显 -->\r\n                <div  v-if=\"!uploadShow\" id=\"uploadSuccessShowName\">\r\n                    <span>文件名：{{uploadFilename}}</span>\r\n                    <i class=\"el-icon-circle-check\" id=\"uploadSuccessShowIcon\"></i>\r\n                </div>\r\n            </div>\r\n            <!-- 上传按钮 -->\r\n            <el-button type=\"text\"\r\n                       style=\"font-size: 16px;margin-top: 15px\"\r\n                       @click=\"saveEditExperiment\">\r\n                保存编辑\r\n            </el-button>\r\n        </el-dialog>\r\n\r\n        <!--表格-->\r\n        <template>\r\n            <el-table\r\n                    ref=\"noticeMultipleTable\"\r\n                    :data=\"experimentData\"\r\n                    style=\"width: 100%\"\r\n                    :row-class-name=\"tableRowClassName\"\r\n                    @row-click=\"rowClick\">\r\n                <el-table-column\r\n                        label=\"序号\"\r\n                        type=\"index\"\r\n                        align=\"center\"\r\n                        width=\"100\">\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        prop=\"title\"\r\n                        label=\"标题\"\r\n                        align=\"center\"\r\n                        sortable\r\n                        width=\"400\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                        label=\"任务书\"\r\n                        align=\"center\"\r\n                        width=\"400\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button v-if=\"scope.row.fileName !==''\" type=\"text\" @click=\"downloadFile(scope.row)\">\r\n                            <i class=\"el-icon-download\"></i>{{scope.row.fileName.substring(6)}}\r\n                        </el-button>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"formatDate\"\r\n                        label=\"创建日期\"\r\n                        align=\"center\"\r\n                        sortable>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        align=\"center\"\r\n                        label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" @click=\"editRow(scope.row)\">编辑</el-button>\r\n                        <el-button type=\"danger\" @click=\"deleteRow(scope.row)\">删除</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n\r\n            </el-table>\r\n        </template>\r\n\r\n        <!-- 分页工具条 数据小于10条不展示 -->\r\n        <el-pagination\r\n                id=\"pageBar\"\r\n                v-show=\"totalCount >= 10\"\r\n                @size-change=\"handleSizeChange\"\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-sizes=\"[5, 10, 15, 20, 50, 100]\"\r\n                :page-size=\"pageSize\"\r\n                layout=\"total, sizes, prev, pager, next, jumper\"\r\n                :total=\"totalCount\">\r\n        </el-pagination>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import SearchBox from \"@/components/SearchBox\";\r\n    export default {\r\n        name: 'ExperimentTab',\r\n        components:{\r\n            SearchBox,\r\n        },\r\n        data(){\r\n            return{\r\n                // 当前页码\r\n                currentPage: 1,\r\n                // 分页大小\r\n                pageSize: 10,\r\n                // 总页码数\r\n                totalCount: 1,\r\n                // 内置查询模型\r\n                searchTitle:{\r\n                    title:'',\r\n                },\r\n                experimentEditDate:{\r\n                    experimentId:undefined,\r\n                    title:'',\r\n                    fileName:'',\r\n                },\r\n                // 实验编辑对话框\r\n                dialogVisible:false,\r\n                // 上传文件显示\r\n                uploadShow:true,\r\n                // 编辑状态激活\r\n                isEditExperiment:false,\r\n                // 文件上传成功后显示文件名并隐藏上传组件\r\n                uploadFilename:'',\r\n                // 考试数据\r\n                experimentData:[],\r\n                // 旧文件名\r\n                filenameOld:'',\r\n                // 课程id\r\n                courseId:'',\r\n            }\r\n        },\r\n        created() {\r\n            this.getExperiment();\r\n        },\r\n        methods:{\r\n            // 查询实验数据\r\n            getExperiment(){\r\n                this.searchTitle[\"pageSize\"]=this.pageSize;\r\n                this.searchTitle[\"currentPage\"]=this.currentPage;\r\n                this.$axios.post(\"/Experiment/getPageByCondition\",this.searchTitle).then((res)=>{\r\n                    if(res.data.flag){\r\n                        /* 保存公告数据 */\r\n                        this.experimentData = res.data.data.records;\r\n                        /* 保存分页数据 */\r\n                        this.totalCount = res.data.data.total;\r\n                        this.currentPage = res.data.data.current;\r\n                        this.pageSize = res.data.data.size;\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 提交搜索\r\n            searchExperiment(title){\r\n                this.searchTitle.title = title;\r\n                this.getExperiment();\r\n            },\r\n            // 表格颜色控制\r\n            tableRowClassName({row, rowIndex}) {\r\n                if (rowIndex%4 === 1) {\r\n                    return 'warning-row';\r\n                } else if (rowIndex%4 === 3) {\r\n                    return 'success-row';\r\n                }\r\n                return '';\r\n            },\r\n            // 当某行数据被点击 todo\r\n            rowClick(row,column){\r\n                if(column.label === '操作')return;\r\n                // 打开实验详情页面\r\n                this.$router.push({\r\n                    name:'ExperimentView',\r\n                    params:{\r\n                        experimentId:row.experimentId,\r\n                    }\r\n                })\r\n            },\r\n            // 创建实验\r\n            createExperiment(){\r\n                // 显示上传框\r\n                this.uploadShow = true;\r\n                // 重置数据\r\n                this.uploadFilename = '';\r\n                this.experimentEditDate.fileName = '';\r\n                this.experimentEditDate.title = '';\r\n                this.experimentEditDate.experimentId = undefined;\r\n                this.dialogVisible = true;\r\n            },\r\n            // 编辑实验\r\n            editRow(row){\r\n                // 显示上传框\r\n                this.uploadShow = true;\r\n                this.isEditExperiment = true;   // 激活编辑状态\r\n                // 重置数据\r\n                this.uploadFilename = '';\r\n                this.filenameOld = row.fileName;\r\n                this.courseId = row.courseId;\r\n                this.experimentEditDate.fileName = row.fileName;\r\n                this.experimentEditDate.title = row.title;\r\n                this.experimentEditDate.experimentId = row.experimentId;\r\n                this.dialogVisible = true;\r\n            },\r\n            // 发布实验\r\n            saveEditExperiment(){\r\n                if(this.experimentEditDate.title === \"\"){\r\n                    this.$message.error(\"标题不能为空！\");\r\n                    return 0;\r\n                }\r\n                if(this.isEditExperiment){\r\n                    this.$axios.post(\"/Experiment/updateExperiment\",this.experimentEditDate).then((res)=>{\r\n                        if(res.data.flag){\r\n                            this.$message.success(res.data.msg);\r\n                            this.getExperiment();\r\n                            this.isEditExperiment = false;  // 关闭编辑状态\r\n                            this.dialogVisible = false;     // 关闭编辑窗口\r\n                            if(this.filenameOld !== this.experimentEditDate.fileName){\r\n                                // 文件更新-清理旧文件\r\n                                let resource = {\r\n                                    resourceName:this.filenameOld,\r\n                                    courseId:this.courseId,\r\n                                };\r\n                                this.$axios.post(\"/Files/resourceDelete\",resource);\r\n                            }\r\n                        }else{\r\n                            this.$message.error(res.data.msg);\r\n                        }\r\n                    })\r\n                }else{\r\n                    this.$axios.post(\"/Experiment/createExperiment\",this.experimentEditDate).then((res)=>{\r\n                        if(res.data.flag){\r\n                            this.$message.success(res.data.msg);\r\n                            this.getExperiment();\r\n                            this.dialogVisible = false;\r\n                        }else{\r\n                            this.$message.error(res.data.msg);\r\n                        }\r\n                    })\r\n                }\r\n            },\r\n            // 删除实验\r\n            deleteRow(row){\r\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    console.log(row)\r\n                    this.$axios.post(\"/Experiment/deleteOneById\",row).then((res)=>{\r\n                        if(res.data.flag){\r\n                            // 根据路径删除本地文件\r\n                            let resource = {\r\n                                resourceName:row.fileName,\r\n                                courseId:row.courseId,\r\n                            };\r\n                            this.$axios.post(\"/Files/resourceDelete\",resource).then(resp=>{\r\n                                if(resp.data === true){\r\n                                    this.$message.success('删除成功！');\r\n                                }else{\r\n                                    this.$message.error('删除失败！');\r\n                                }\r\n                            });\r\n                            this.getExperiment();\r\n                        }else{\r\n                            // 服务故障\r\n                            this.$message.error(\"信息获取失败！\");\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n            // 下载文件\r\n            downloadFile(row){\r\n                let url = \"http://\" + window.location.host + \"/Files/resourceDownload\";\r\n                const xhr = new XMLHttpRequest();\r\n                xhr.open('post', url);\r\n                xhr.responseType = 'blob';\r\n                //3.5 请求头（POST请求时设置）\r\n                xhr.setRequestHeader('Content-Type','application/json')\r\n                // xhr.setRequestHeader(\"Content-type\",\"application/json;charset=UTF-8\");\r\n                xhr.send(JSON.stringify({fileName:row.fileName}));\r\n                xhr.onload = function () {\r\n                    if (this.status === 200 || this.status === 304) {\r\n                        const fileReader = new FileReader();\r\n                        fileReader.readAsDataURL(this.response);\r\n                        fileReader.onload = function () {\r\n                            const a = document.createElement('a');\r\n                            a.style.display = 'none';\r\n                            a.href = this.result;\r\n                            a.download = row.fileName;\r\n                            document.body.appendChild(a);\r\n                            a.click();\r\n                            document.body.removeChild(a);\r\n                        };\r\n                    }\r\n                };\r\n                // 解决多弹窗重叠问题\r\n                setTimeout(()=>{this.$message.success(\"下载:\"+row.fileName+\" 完成！\")},1000);\r\n            },\r\n            // 文件上传成功的钩子-回显并写入数据\r\n            handleFileSuccess(res, file) {\r\n                if(res !== ''){\r\n                    // 组织实验信息\r\n                    this.experimentEditDate.fileName = res;\r\n                    // 关闭上传组件\r\n                    this.uploadShow = false;\r\n                    // 回显文件名\r\n                    this.uploadFilename = file.name;\r\n                }else{\r\n                    this.$message.error(\"上传失败！\");\r\n                }\r\n            },\r\n            // 文件类型和大小检查\r\n            beforeFileUpload(file) {\r\n                const isLt10M = file.size / 1024 / 1024 < 10;\r\n                if (!isLt10M) {\r\n                    this.$message.error('任务书大小不能超过 10MB!');\r\n                }\r\n                return isLt10M;\r\n            },\r\n            // 分页大小变化\r\n            handleSizeChange(val) {\r\n                this.pageSize = val;\r\n                // 查询所有实验\r\n                this.getExperiment();\r\n            },\r\n            // 当前页变化\r\n            handleCurrentChange(val) {\r\n                this.currentPage = val;\r\n                // 查询所有实验\r\n                this.getExperiment();\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /* 上传框文本 */\r\n    .createChapterInfo{\r\n        font-size: 16px;\r\n        margin-bottom: 10px;\r\n    }\r\n    /* 文件上传框 */\r\n    ::v-deep .el-upload{\r\n        width: 100% !important;\r\n    }\r\n    ::v-deep .el-upload-dragger{\r\n        width: 100% !important;\r\n        height: 300px !important;\r\n    }\r\n    /* 文件上传成功后回显文件名 */\r\n    #uploadSuccessShowName{\r\n        margin-top:1em;\r\n        font-size: 16px;\r\n    }\r\n    #uploadSuccessShowIcon{\r\n        color: #77ee77;\r\n        margin-left: 0.5em;\r\n    }\r\n    /* 编辑提示 */\r\n    ::v-deep #updateCourseInfoEditorTags{\r\n        font-size: 18px;\r\n        color: #000000;\r\n        height: 50px;\r\n        margin-bottom: 30px;\r\n    }\r\n    /* 表格字体 */\r\n    .el-table{\r\n        font-size: 17px;\r\n    }\r\n    /* 表格行高控制 */\r\n    ::v-deep .el-table .el-table__cell{\r\n        padding: 9px 0;\r\n    }\r\n    /* 分页工具条上框 */\r\n    #pageBar{\r\n        margin-top: 20px;\r\n    }\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}