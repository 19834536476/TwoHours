{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport SearchBox from \"@/components/SearchBox\";\nexport default {\n  name: 'ExperimentTab',\n  components: {\n    SearchBox: SearchBox\n  },\n  data: function data() {\n    return {\n      // 当前页码\n      currentPage: 1,\n      // 分页大小\n      pageSize: 10,\n      // 总页码数\n      totalCount: 1,\n      // 内置查询模型\n      searchTitle: {},\n      // 报告数据\n      reports: []\n    };\n  },\n  created: function created() {\n    this.getReports();\n  },\n  methods: {\n    // 查询实验报告数据\n    getReports: function getReports() {\n      var _this = this;\n\n      this.searchTitle[\"id\"] = this.$route.params.experimentId;\n      this.searchTitle[\"pageSize\"] = this.pageSize;\n      this.searchTitle[\"currentPage\"] = this.currentPage;\n      this.$axios.post(\"/Experiment/getReportsByCondition\", this.searchTitle).then(function (res) {\n        if (res.data.flag) {\n          /* 保存公告数据 */\n          _this.reports = res.data.data.records;\n          /* 保存分页数据 */\n\n          _this.totalCount = res.data.data.total;\n          _this.currentPage = res.data.data.current;\n          _this.pageSize = res.data.data.size;\n        } else {\n          // 服务故障\n          _this.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 表格颜色控制\n    tableRowClassName: function tableRowClassName(_ref) {\n      var row = _ref.row,\n          rowIndex = _ref.rowIndex;\n\n      if (rowIndex % 4 === 1) {\n        return 'warning-row';\n      } else if (rowIndex % 4 === 3) {\n        return 'success-row';\n      }\n\n      return '';\n    },\n    // 下载报告\n    downloadReport: function downloadReport(row) {\n      var _this2 = this;\n\n      if (row.fileName === null) {\n        this.$message.warning(\"文件不存在！\");\n        return;\n      }\n\n      var url = \"http://\" + window.location.host + \"/Files/reportDownloadTec\";\n      var xhr = new XMLHttpRequest();\n      xhr.open('post', url);\n      xhr.responseType = 'blob'; //3.5 请求头（POST请求时设置）\n\n      xhr.setRequestHeader('Content-Type', 'application/json'); // xhr.setRequestHeader(\"Content-type\",\"application/json;charset=UTF-8\");\n\n      xhr.send(JSON.stringify({\n        fileName: row.fileName,\n        userId: row.userId\n      }));\n\n      xhr.onload = function () {\n        if (this.status === 200 || this.status === 304) {\n          var fileReader = new FileReader();\n          fileReader.readAsDataURL(this.response);\n\n          fileReader.onload = function () {\n            var a = document.createElement('a');\n            a.style.display = 'none';\n            a.href = this.result;\n            a.download = row.fileName;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n          };\n        }\n      }; // 解决多弹窗重叠问题\n\n\n      setTimeout(function () {\n        _this2.$message.success(\"下载:\" + row.fileName + \" 完成！\");\n      }, 1000);\n    },\n    // 分页大小变化\n    handleSizeChange: function handleSizeChange(val) {\n      this.pageSize = val; // 查询所有实验\n\n      this.getReports();\n    },\n    // 当前页变化\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.currentPage = val; // 查询所有实验\n\n      this.getReports();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACAA,uBADA;AAEAC;AACAC;AADA,GAFA;AAKAC,MALA,kBAKA;AACA;AACA;AACAC,oBAFA;AAGA;AACAC,kBAJA;AAKA;AACAC,mBANA;AAOA;AACAC,qBARA;AASA;AACAC;AAVA;AAYA,GAlBA;AAmBAC,SAnBA,qBAmBA;AACA;AACA,GArBA;AAsBAC;AACA;AACAC,cAFA,wBAEA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,SAPA,MAOA;AACA;AACA;AACA;AACA,OAZA;AAaA,KAnBA;AAoBA;AACAC,qBArBA,mCAqBA;AAAA;AAAA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AACA;AACA,KA5BA;AA6BA;AACAC,kBA9BA,0BA8BAC,GA9BA,EA8BA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACAC;AACAA,gCARA,CASA;;AACAA,+DAVA,CAWA;;AACAA;AAAAC;AAAAC;AAAA;;AACAF;AACA;AACA;AACAG;;AACAA;AACA;AACAC;AACAA;AACAA;AACAC;AACAD;AACAC;AACA,WARA;AASA;AACA,OAdA,CAbA,CA4BA;;;AACAC;AAAA;AAAA;AACA,KA5DA;AA6DA;AACAC,oBA9DA,4BA8DAC,GA9DA,EA8DA;AACA,0BADA,CAEA;;AACA;AACA,KAlEA;AAmEA;AACAC,uBApEA,+BAoEAD,GApEA,EAoEA;AACA,6BADA,CAEA;;AACA;AACA;AAxEA;AAtBA","names":["name","components","SearchBox","data","currentPage","pageSize","totalCount","searchTitle","reports","created","methods","getReports","tableRowClassName","downloadReport","row","xhr","fileName","userId","fileReader","a","document","setTimeout","handleSizeChange","val","handleCurrentChange"],"sourceRoot":"src/pages/user/teacherComponents","sources":["ExperimentView.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <!--表格-->\r\n        <template>\r\n            <el-table\r\n                    ref=\"noticeMultipleTable\"\r\n                    :data=\"reports\"\r\n                    style=\"width: 100%\"\r\n                    :row-class-name=\"tableRowClassName\">\r\n                <el-table-column\r\n                        label=\"序号\"\r\n                        type=\"index\"\r\n                        align=\"center\"\r\n                        width=\"100\">\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        prop=\"username\"\r\n                        label=\"姓名\"\r\n                        align=\"center\"\r\n                        sortable\r\n                        width=\"400\">\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        label=\"学生报告\"\r\n                        align=\"center\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"text\" @click=\"downloadReport(scope.row)\">\r\n                            <i class=\"el-icon-download\"></i>\r\n                            <span v-if=\"scope.row.fileName !== null\">{{scope.row.fileName.substring(6)}}</span>\r\n                            <span v-else>无</span>\r\n                        </el-button>\r\n                    </template>\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        prop=\"formatDate\"\r\n                        label=\"创建日期\"\r\n                        align=\"center\"\r\n                        sortable>\r\n                </el-table-column>\r\n\r\n            </el-table>\r\n        </template>\r\n\r\n        <!-- 分页工具条 数据小于10条不展示 -->\r\n        <el-pagination\r\n                id=\"pageBar\"\r\n                v-show=\"totalCount >= 10\"\r\n                @size-change=\"handleSizeChange\"\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-sizes=\"[5, 10, 15, 20, 50, 100]\"\r\n                :page-size=\"pageSize\"\r\n                layout=\"total, sizes, prev, pager, next, jumper\"\r\n                :total=\"totalCount\">\r\n        </el-pagination>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import SearchBox from \"@/components/SearchBox\";\r\n    export default {\r\n        name: 'ExperimentTab',\r\n        components:{\r\n            SearchBox,\r\n        },\r\n        data(){\r\n            return{\r\n                // 当前页码\r\n                currentPage: 1,\r\n                // 分页大小\r\n                pageSize: 10,\r\n                // 总页码数\r\n                totalCount: 1,\r\n                // 内置查询模型\r\n                searchTitle:{},\r\n                // 报告数据\r\n                reports:[],\r\n            }\r\n        },\r\n        created() {\r\n            this.getReports();\r\n        },\r\n        methods:{\r\n            // 查询实验报告数据\r\n            getReports(){\r\n                this.searchTitle[\"id\"]=this.$route.params.experimentId;\r\n                this.searchTitle[\"pageSize\"]=this.pageSize;\r\n                this.searchTitle[\"currentPage\"]=this.currentPage;\r\n                this.$axios.post(\"/Experiment/getReportsByCondition\",this.searchTitle).then((res)=>{\r\n                    if(res.data.flag){\r\n                        /* 保存公告数据 */\r\n                        this.reports = res.data.data.records;\r\n                        /* 保存分页数据 */\r\n                        this.totalCount = res.data.data.total;\r\n                        this.currentPage = res.data.data.current;\r\n                        this.pageSize = res.data.data.size;\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 表格颜色控制\r\n            tableRowClassName({row, rowIndex}) {\r\n                if (rowIndex%4 === 1) {\r\n                    return 'warning-row';\r\n                } else if (rowIndex%4 === 3) {\r\n                    return 'success-row';\r\n                }\r\n                return '';\r\n            },\r\n            // 下载报告\r\n            downloadReport(row){\r\n                if(row.fileName === null) {\r\n                    this.$message.warning(\"文件不存在！\")\r\n                    return;\r\n                }\r\n                let url = \"http://\" + window.location.host + \"/Files/reportDownloadTec\";\r\n                const xhr = new XMLHttpRequest();\r\n                xhr.open('post', url);\r\n                xhr.responseType = 'blob';\r\n                //3.5 请求头（POST请求时设置）\r\n                xhr.setRequestHeader('Content-Type','application/json')\r\n                // xhr.setRequestHeader(\"Content-type\",\"application/json;charset=UTF-8\");\r\n                xhr.send(JSON.stringify({fileName:row.fileName,userId:row.userId}));\r\n                xhr.onload = function () {\r\n                    if (this.status === 200 || this.status === 304) {\r\n                        const fileReader = new FileReader();\r\n                        fileReader.readAsDataURL(this.response);\r\n                        fileReader.onload = function () {\r\n                            const a = document.createElement('a');\r\n                            a.style.display = 'none';\r\n                            a.href = this.result;\r\n                            a.download = row.fileName;\r\n                            document.body.appendChild(a);\r\n                            a.click();\r\n                            document.body.removeChild(a);\r\n                        };\r\n                    }\r\n                };\r\n                // 解决多弹窗重叠问题\r\n                setTimeout(()=>{this.$message.success(\"下载:\"+row.fileName+\" 完成！\")},1000);\r\n            },\r\n            // 分页大小变化\r\n            handleSizeChange(val) {\r\n                this.pageSize = val;\r\n                // 查询所有实验\r\n                this.getReports();\r\n            },\r\n            // 当前页变化\r\n            handleCurrentChange(val) {\r\n                this.currentPage = val;\r\n                // 查询所有实验\r\n                this.getReports();\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /* 表格字体 */\r\n    .el-table{\r\n        font-size: 17px;\r\n    }\r\n    /* 表格行高控制 */\r\n    ::v-deep .el-table .el-table__cell{\r\n        padding: 9px 0;\r\n    }\r\n    /* 分页工具条上框 */\r\n    #pageBar{\r\n        margin-top: 20px;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}