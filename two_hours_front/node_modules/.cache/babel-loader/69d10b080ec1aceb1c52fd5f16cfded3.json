{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UserAvatar from \"@/components/UserAvatar\";\nexport default {\n  name: \"ExamInfoView\",\n  components: {\n    UserAvatar: UserAvatar\n  },\n  data: function data() {\n    return {\n      exam: {},\n      // 考试信息\n      activeNames: [],\n      // 试题激活项\n      studentExams: [],\n      // 学生列表\n      subjects: [] // 试题集合\n\n    };\n  },\n  created: function created() {\n    this.getExam();\n  },\n  methods: {\n    // 查询考试数据\n    getExam: function getExam() {\n      var _this = this;\n\n      var exam = {\n        examId: this.$route.params.examId\n      };\n      this.$axios.post(\"/Exam/getExamById\", exam).then(function (res) {\n        if (res.data.flag) {\n          /* 保存公告数据 */\n          _this.exam = res.data.data;\n\n          _this.getSubject(); // 获取标准答案\n\n\n          _this.getStudentExams(); // 获取所有学生的考试信息\n\n        } else {\n          // 服务故障\n          _this.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 查询试题数据\n    getSubject: function getSubject() {\n      var _this2 = this;\n\n      this.$axios.post(\"/Paper/getPaperByExamId\", this.exam).then(function (res) {\n        if (res.data.flag) {\n          /* 保存公告数据 */\n          _this2.subjects = res.data.data;\n        } else {\n          // 服务故障\n          _this2.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 获取所有学生的考试信息\n    getStudentExams: function getStudentExams() {\n      var _this3 = this;\n\n      this.$axios.post(\"/Answer/getAllUserAnswer\", this.exam).then(function (res) {\n        if (res.data.flag) {\n          _this3.studentExams = res.data.data;\n\n          _this3.addActiveNames();\n        } else {\n          // 服务故障\n          _this3.$message.error(\"信息获取失败！\");\n        }\n      });\n    },\n    // 给所有学生数据添加项目控制器\n    addActiveNames: function addActiveNames() {\n      for (var i in this.studentExams) {\n        this.studentExams[i]['activeNames'] = [];\n      }\n    },\n    // 表格颜色控制\n    tableRowClassName: function tableRowClassName(_ref) {\n      var row = _ref.row,\n          rowIndex = _ref.rowIndex;\n\n      if (rowIndex % 4 === 1) {\n        return 'warning-row';\n      } else if (rowIndex % 4 === 3) {\n        return 'success-row';\n      }\n\n      return '';\n    },\n    // 全部折叠\n    allHidden: function allHidden() {\n      this.activeNames = [];\n    },\n    // 全部展开\n    allShow: function allShow() {\n      this.allHidden();\n      /* 激活全部题组 */\n\n      for (var i = 0; i < this.studentExams.length; i++) {\n        this.$set(this.activeNames, i, i);\n      }\n    },\n    // 展开答案列表\n    solutionsShow: function solutionsShow(item) {\n      for (var j in item.solutions) {\n        this.$set(item.activeNames, j, item.userId + j);\n      }\n    },\n    // 折叠答案列表\n    solutionsHidden: function solutionsHidden(item) {\n      item.activeNames = [];\n      this.allHidden();\n    },\n    // 分数检查\n    subjectiveScoreCheck: function subjectiveScoreCheck(solution, stdScore) {\n      if (solution.score > stdScore || solution.score < 0 || isNaN(solution.score)) {\n        solution.score = 0;\n        this.$message.warning(\"输入格式有误\");\n      }\n    },\n    // 总分计算\n    calTotalScore: function calTotalScore(item) {\n      item.score = 0;\n\n      for (var i in item.solutions) {\n        item.score += item.solutions[i].score;\n      }\n    },\n    // 提交评分-参数为StudentExam类型\n    submitScore: function submitScore(item) {\n      var _this4 = this;\n\n      this.$confirm('确认分数无误后提交, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        // item应提交给后台，保存其score和solutions中的score\n        _this4.$axios.post(\"/Answer/judgeOnesPaper\", item).then(function (res) {\n          if (res.data.flag) {\n            // 持久化完成\n            _this4.$message.success(res.data.msg); // 刷新数据\n\n\n            _this4.getStudentExams();\n          } else {\n            _this4.$message.error(res.data.msg);\n          }\n        });\n      });\n    },\n    // 重新评分\n    reJudge: function reJudge(item) {\n      var _this5 = this;\n\n      this.$confirm('是否重新判卷?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this5.$axios.post(\"/Answer/reJudge\", item).then(function (res) {\n          if (res.data.flag) {\n            item.isChecked = 0;\n            item.isCheckedBool = false;\n          } else {\n            _this5.$message.error(res.data.msg);\n          }\n        });\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8OA;AACA;AACAA,sBADA;AAEAC;AACAC;AADA,GAFA;AAKAC,MALA,kBAKA;AACA;AACAC,cADA;AACA;AACAC,qBAFA;AAEA;AACAC,sBAHA;AAGA;AACAC,kBAJA,CAIA;;AAJA;AAMA,GAZA;AAaAC,SAbA,qBAaA;AACA;AACA,GAfA;AAgBAC;AACA;AACAC,WAFA,qBAEA;AAAA;;AACA;AAAAC;AAAA;AACA;AACA;AACA;AACA;;AACA,6BAHA,CAGA;;;AACA,kCAJA,CAIA;;AACA,SALA,MAKA;AACA;AACA;AACA;AACA,OAVA;AAWA,KAfA;AAgBA;AACAC,cAjBA,wBAiBA;AAAA;;AACA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;AACA,OARA;AASA,KA3BA;AA4BA;AACAC,mBA7BA,6BA6BA;AAAA;;AACA;AACA;AACA;;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;AACA,OARA;AASA,KAvCA;AAwCA;AACAC,kBAzCA,4BAyCA;AACA;AACA;AACA;AACA,KA7CA;AA8CA;AACAC,qBA/CA,mCA+CA;AAAA;AAAA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AACA;AACA,KAtDA;AAuDA;AACAC,aAxDA,uBAwDA;AACA;AACA,KA1DA;AA2DA;AACAC,WA5DA,qBA4DA;AACA;AACA;;AACA;AAAA;AAAA;AACA,KAhEA;AAiEA;AACAC,iBAlEA,yBAkEAC,IAlEA,EAkEA;AACA;AACA;AACA;AACA,KAtEA;AAuEA;AACAC,mBAxEA,2BAwEAD,IAxEA,EAwEA;AACAA;AACA;AACA,KA3EA;AA4EA;AACAE,wBA7EA,gCA6EAC,QA7EA,EA6EAC,QA7EA,EA6EA;AACA;AACAD;AACA;AACA;AACA,KAlFA;AAmFA;AACAE,iBApFA,yBAoFAL,IApFA,EAoFA;AACAA;;AACA;AACAA;AACA;AACA,KAzFA;AA0FA;AACAM,eA3FA,uBA2FAN,IA3FA,EA2FA;AAAA;;AACA;AACAO,+BADA;AAEAC,8BAFA;AAGAC;AAHA,SAIAC,IAJA,CAIA;AACA;AACA;AACA;AAAA;AACA,kDADA,CAEA;;;AACA;AACA,WAJA,MAIA;AACA;AACA;AACA,SARA;AASA,OAfA;AAgBA,KA5GA;AA6GA;AACAC,WA9GA,mBA8GAX,IA9GA,EA8GA;AAAA;;AACA;AACAO,+BADA;AAEAC,8BAFA;AAGAC;AAHA,SAIAC,IAJA,CAIA;AACA;AACA;AACAV;AACAA;AACA,WAHA,MAGA;AACA;AACA;AACA,SAPA;AAQA,OAbA;AAcA;AA7HA;AAhBA","names":["name","components","UserAvatar","data","exam","activeNames","studentExams","subjects","created","methods","getExam","examId","getSubject","getStudentExams","addActiveNames","tableRowClassName","allHidden","allShow","solutionsShow","item","solutionsHidden","subjectiveScoreCheck","solution","stdScore","calTotalScore","submitScore","confirmButtonText","cancelButtonText","type","then","reJudge"],"sourceRoot":"src/pages/user/teacherComponents","sources":["ExamInfoView.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <!-- 考试详情 -->\r\n        <el-card :body-style=\"{ padding: '0px'}\" style=\"margin-top: 2em\">\r\n            <div id=\"examCards\">\r\n                <!-- 标题和时间 -->\r\n                <div style=\"margin-top: 1.2em;\">\r\n                    <span id=\"examTitle\">{{exam.title}}</span>\r\n                    <span id=\"examDate\">{{exam.formatCreateDate}}</span>\r\n                </div>\r\n                <!-- 内容 -->\r\n                <div id=\"examDetails\" v-html=\"exam.detail\">{{exam.detail}}</div>\r\n            </div>\r\n        </el-card>\r\n        <!-- 分界线 -->\r\n        <el-divider id=\"myDivider\"><div style=\"font-size: 18px\">数据统计</div></el-divider>\r\n        <!-- 考生数据 -->\r\n        <el-card id=\"subjectCard\">\r\n            <!-- 功能区 -->\r\n            <div id=\"functionCard\">\r\n                <el-button type=\"text\" class=\"conSubjectButton\" @click=\"allHidden\">全部折叠</el-button>\r\n                <el-button type=\"text\" class=\"conSubjectButton\" @click=\"allShow\">全部展开</el-button>\r\n            </div>\r\n            <!-- 数据区 -->\r\n            <el-collapse v-model=\"activeNames\">\r\n                <!-- 无用户数据 -->\r\n                <div id=\"emptySubject\" v-if=\"studentExams.length === 0\">暂无数据</div>\r\n                <!-- 用户数据展示 -->\r\n                <el-collapse-item v-else v-for=\"(item,index) in studentExams\" :key=\"index\" :name=\"index\">\r\n                    <!-- 标题 -->\r\n                    <template slot=\"title\">\r\n                        <span style=\"font-size:15px;margin-left: 0.8em; position: relative;\">\r\n                            <!-- 序号 -->\r\n                            <span class=\"subjectNum\">{{index+1}}</span>\r\n                            <!-- 选择题 -->\r\n                            <span class=\"tagBox\">\r\n                                <user-avatar class=\"userAvatar\" :src=\"item.userAvatar\" :width=\"38\" :height=\"38\"></user-avatar>\r\n                                <span class=\"username\">{{item.username}}</span>\r\n                                <el-tag class=\"subjectTag\" v-if=\"item.submit\">已交卷</el-tag>\r\n                                <el-tag class=\"subjectTag\" v-else type=\"danger\"  >未交卷</el-tag>\r\n                                <el-tag class=\"subjectTag\" type=\"success\" v-if=\"item.isCheckedBool\">已判卷</el-tag>\r\n                                <el-tag class=\"subjectTag\" type=\"warning\" v-else-if=\"item.submit\">待评分</el-tag>\r\n                                <el-tag class=\"subjectTag\" type=\"success\" v-if=\"item.systemCheckedBool\">客观题：{{item.objectiveScore}}分</el-tag>\r\n                                <el-tag class=\"subjectTag\" type=\"success\" v-if=\"item.isCheckedBool\">总分：{{item.score}}分</el-tag>\r\n                            </span>\r\n                        </span>\r\n                    </template>\r\n                    <!-- 内容 -->\r\n                    <div v-if=\"item.submit\" class=\"subjectContent\">\r\n                        <!-- 折叠按钮 -->\r\n                        <el-button type=\"text\" style=\"margin-left: 5em\" @click=\"solutionsShow(item)\">展开</el-button>\r\n                        <el-button type=\"text\" style=\"margin-left: 1em\" @click=\"solutionsHidden(item)\">折叠</el-button>\r\n                        <!-- 判卷区 -->\r\n                        <el-collapse v-model=\"item.activeNames\">\r\n                            <el-collapse-item v-for=\"(solution,i) in item.solutions\" :key=\"item.userId+i\" :name=\"item.userId+i\">\r\n                                <!-- 标题行：显示题号/题型/得分 -->\r\n                                <template slot=\"title\">\r\n                                    <el-row style=\"width: 90em;font-size: 15px\">\r\n                                        <!-- 题号 -->\r\n                                        <el-col :span=\"1\" style=\"text-align: right\">\r\n                                            <div style=\"margin-right: 0.8em\">{{i+1}}.</div>\r\n                                        </el-col>\r\n                                        <!-- 题型和分数 -->\r\n                                        <el-col :span=\"2\">\r\n                                            <!-- 选择题 -->\r\n                                            <div v-if=\"solution.subjectType === 1\">\r\n                                                <el-tag class=\"normalTag subjectTypeTag\" v-if=\"solution.answerNum > 1\">多选（{{subjects[i].choice.score}}分）</el-tag>\r\n                                                <el-tag class=\"normalTag subjectTypeTag\" v-else>单选（{{subjects[i].choice.score}}分）</el-tag>\r\n                                            </div>\r\n                                            <!-- 填空题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 2\">\r\n                                                <el-tag class=\"normalTag subjectTypeTag\">填空（{{subjects[i].filling.score}}分）</el-tag>\r\n                                            </div>\r\n                                            <!-- 判断题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 3\">\r\n                                                <el-tag class=\"normalTag subjectTypeTag\">判断（{{subjects[i].trueFalse.score}}分）</el-tag>\r\n                                            </div>\r\n                                            <!-- 简答题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 4\">\r\n                                                <el-tag class=\"normalTag subjectTypeTag\">简答（{{subjects[i].questionAnswer.score}}分）</el-tag>\r\n                                            </div>\r\n                                        </el-col>\r\n                                        <!-- 得分 -->\r\n                                        <el-col :span=\"2\">\r\n                                            <!-- 选择题 -->\r\n                                            <div v-if=\"solution.subjectType === 1\">\r\n                                                <el-tag type=\"success\" class=\"normalTag scoreTag\" v-if=\"solution.score === subjects[i].choice.score\" >得分：{{solution.score}}分</el-tag>\r\n                                                <el-tag type=\"warning\" class=\"normalTag scoreTag\" v-else-if=\"solution.score > 0\" >得分：{{solution.score}}分</el-tag>\r\n                                                <!-- 0分项目 -->\r\n                                                <el-tag type=\"danger\"  class=\"normalTag scoreTag\" v-else >得分：{{solution.score}}分</el-tag>\r\n                                            </div>\r\n                                            <!-- 填空题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 2\">\r\n                                                <el-tag type=\"success\" class=\"normalTag scoreTag\" v-if=\"solution.score === subjects[i].filling.score\" >得分：{{solution.score}}分</el-tag>\r\n                                                <el-tag type=\"warning\" class=\"normalTag scoreTag\" v-else-if=\"solution.score > 0\" >得分：{{solution.score}}分</el-tag>\r\n                                                <!-- 0分项目 -->\r\n                                                <el-tag type=\"danger\"  class=\"normalTag scoreTag\" v-else >得分：{{solution.score}}分</el-tag>\r\n                                            </div>\r\n                                            <!-- 判断题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 3\">\r\n                                                <el-tag type=\"success\" class=\"normalTag scoreTag\" v-if=\"solution.score === subjects[i].trueFalse.score\" >得分：{{solution.score}}分</el-tag>\r\n                                                <el-tag type=\"warning\" class=\"normalTag scoreTag\" v-else-if=\"solution.score > 0\" >得分：{{solution.score}}分</el-tag>\r\n                                                <!-- 0分项目 -->\r\n                                                <el-tag type=\"danger\"  class=\"normalTag scoreTag\" v-else >得分：{{solution.score}}分</el-tag>\r\n                                            </div>\r\n                                            <!-- 简答题 -->\r\n                                            <div v-else-if=\"solution.subjectType === 4\">\r\n                                                <span v-if=\"item.isCheckedBool\">\r\n                                                    <el-tag type=\"success\" class=\"normalTag scoreTag\" v-if=\"solution.score === subjects[i].questionAnswer.score\" >得分：{{solution.score}}分</el-tag>\r\n                                                    <el-tag type=\"warning\" class=\"normalTag scoreTag\" v-else-if=\"solution.score > 0\" >得分：{{solution.score}}分</el-tag>\r\n                                                        <!-- 0分项目 -->\r\n                                                    <el-tag type=\"danger\"  class=\"normalTag scoreTag\" v-else >得分：{{solution.score}}分</el-tag>\r\n                                                </span>\r\n                                                <span v-else >\r\n                                                    <el-tag type=\"info\"  class=\"normalTag scoreTag\" >待评分</el-tag>\r\n                                                </span>\r\n                                            </div>\r\n                                        </el-col>\r\n                                    </el-row>\r\n                                </template>\r\n                                <!-- 展示答题数据和标准答案 -->\r\n                                <div class=\"stdDiv\" style=\"font-size:16px;width: 90%;position: relative;left: 2em\">\r\n                                    <!-- 选择题 -->\r\n                                    <div v-if=\"solution.subjectType == 1\">\r\n                                        <!-- 用户答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag type=\"success\">用户答案</el-tag>\r\n                                            <!-- 多选题 -->\r\n                                            <span v-if=\"solution.answerNum > 1\">\r\n                                                <span v-for=\"(answers,an) in solution.answerOptions\" :key=\"'an'+an\">\r\n                                                    <span style=\"margin: 0 0.4em\" v-if=\"answers.answerBool\">选项{{an+1}}</span>\r\n                                                </span>\r\n                                            </span>\r\n                                            <!-- 单选题 -->\r\n                                            <span v-else>\r\n                                                <span v-for=\"(options1,op1) in subjects[i].choiceOptions\" :key=\"'op1'+op1\">\r\n                                                    <span style=\"margin: 0 0.4em\" v-if=\"options1.num == solution.answer\">选项{{op1+1}}</span>\r\n                                                </span>\r\n                                            </span>\r\n                                        </div>\r\n                                        <!-- 标准答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag>标准答案</el-tag>\r\n                                            <span v-for=\"(options,op) in subjects[i].choiceOptions\" :key=\"'op'+op\">\r\n                                                <span style=\"margin: 0 0.4em\" v-if=\"options.isAnswerBool\">选项{{op+1}}</span>\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- 填空题 -->\r\n                                    <div v-else-if=\"solution.subjectType == 2\">\r\n                                        <!-- 用户答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag type=\"success\">用户答案</el-tag>\r\n                                            <span class=\"lrDiv\" v-for=\"(aBlank,num1) in solution.answerOptions\" :key=\"'u'+num1\">{{num1+1}}.{{aBlank.answer}}</span>\r\n                                        </div>\r\n                                        <!-- 标准答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag>标准答案</el-tag>\r\n                                            <span class=\"lrDiv\" v-for=\"(stdBlank,num2) in subjects[i].fillingBlanks\" :key=\"'a'+num2\">{{num2+1}}.{{stdBlank.content}}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- 判断题 -->\r\n                                    <div v-else-if=\"solution.subjectType == 3\">\r\n                                        <!-- 用户答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag type=\"success\">用户答案</el-tag>\r\n                                            <span class=\"lrDiv\">{{solution.answerStr}}</span>\r\n                                        </div>\r\n                                        <!-- 标准答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag>标准答案</el-tag>\r\n                                            <span class=\"lrDiv\">{{subjects[i].trueFalse.answerStr}}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- 简答题 -->\r\n                                    <div v-else-if=\"solution.subjectType == 4\">\r\n                                        <!-- 用户答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-row style=\"width: 24em\">\r\n                                                <el-col :span=\"6\">\r\n                                                    <el-tag type=\"success\">用户答案</el-tag>\r\n                                                </el-col>\r\n                                                <el-col :span=\"6\"  v-if=\"!item.isCheckedBool\">\r\n                                                    <span style=\"color: #8a8a8a;font-size: 14px;\">在此输入评分:</span>\r\n                                                </el-col>\r\n                                                <el-col :span=\"4\" style=\"position:relative;\" v-if=\"!item.isCheckedBool\">\r\n                                                    <el-input class=\"inputScore\"\r\n                                                              @blur=\"subjectiveScoreCheck(solution,subjects[i].questionAnswer.score)\"\r\n                                                              v-model.number=\"solution.score\"></el-input>\r\n                                                </el-col>\r\n                                                <el-col :span=\"1\" v-if=\"!item.isCheckedBool\">\r\n                                                    <span style=\"margin-left: 0.5em\">分</span>\r\n                                                </el-col>\r\n                                            </el-row>\r\n                                            <div v-html=\"solution.answer\">{{solution.answer}}</div>\r\n                                        </div>\r\n                                        <!-- 标准答案 -->\r\n                                        <div class=\"stdDiv\">\r\n                                            <el-tag>标准答案</el-tag>\r\n                                            <span v-html=\"subjects[i].questionAnswer.answer\">{{subjects[i].questionAnswer.answer}}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </el-collapse-item>\r\n                        </el-collapse>\r\n                        <!-- 功能区 -->\r\n                        <el-row style=\"width: 30em;position: relative;left: 83em\" class=\"editSubjectButton\">\r\n                            <el-col :span=\"4\" v-if=\"!item.isCheckedBool\">\r\n                                <span style=\"position: relative;top:0.5em;left: 2.5em\">总分</span>\r\n                            </el-col>\r\n                            <!-- 输入框 -->\r\n                            <el-col :span=\"4\" v-if=\"!item.isCheckedBool\">\r\n                                <el-input v-model.number=\"item.score\" @focus=\"calTotalScore(item)\" :disabled=\"item.isCheckedBool\"></el-input>\r\n                            </el-col>\r\n                            <!-- 提交按钮 -->\r\n                            <el-col :span=\"7\">\r\n                                <el-button type=\"primary\"\r\n                                           style=\"margin-left: 1em\"\r\n                                           @click=\"submitScore(item)\"\r\n                                           v-if=\"!item.isCheckedBool\"\r\n                                           plain round>确认得分</el-button>\r\n                                <el-button type=\"primary\"\r\n                                           style=\"margin-left: 11em\"\r\n                                           @click=\"reJudge(item)\"\r\n                                           v-else\r\n                                           plain round>重新评分</el-button>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </div>\r\n                    <!-- 用户未提交 -->\r\n                    <div v-else style=\"text-align: center;color:#797979\">暂无数据</div>\r\n                </el-collapse-item>\r\n            </el-collapse>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import UserAvatar from \"@/components/UserAvatar\";\r\n    export default {\r\n        name: \"ExamInfoView\",\r\n        components:{\r\n            UserAvatar,\r\n        },\r\n        data(){\r\n            return{\r\n                exam:{},            // 考试信息\r\n                activeNames:[],     // 试题激活项\r\n                studentExams:[],    // 学生列表\r\n                subjects:[],        // 试题集合\r\n            }\r\n        },\r\n        created(){\r\n            this.getExam();\r\n        },\r\n        methods:{\r\n            // 查询考试数据\r\n            getExam(){\r\n                let exam = {examId:this.$route.params.examId};\r\n                this.$axios.post(\"/Exam/getExamById\", exam).then((res)=>{\r\n                    if(res.data.flag){\r\n                        /* 保存公告数据 */\r\n                        this.exam = res.data.data;\r\n                        this.getSubject();      // 获取标准答案\r\n                        this.getStudentExams(); // 获取所有学生的考试信息\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 查询试题数据\r\n            getSubject(){\r\n                this.$axios.post(\"/Paper/getPaperByExamId\", this.exam).then((res)=>{\r\n                    if(res.data.flag){\r\n                        /* 保存公告数据 */\r\n                        this.subjects = res.data.data;\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 获取所有学生的考试信息\r\n            getStudentExams(){\r\n                this.$axios.post(\"/Answer/getAllUserAnswer\",this.exam).then((res)=>{\r\n                    if(res.data.flag){\r\n                        this.studentExams = res.data.data;\r\n                        this.addActiveNames();\r\n                    }else{\r\n                        // 服务故障\r\n                        this.$message.error(\"信息获取失败！\");\r\n                    }\r\n                });\r\n            },\r\n            // 给所有学生数据添加项目控制器\r\n            addActiveNames(){\r\n                for(let i in this.studentExams){\r\n                    this.studentExams[i]['activeNames'] = [];\r\n                }\r\n            },\r\n            // 表格颜色控制\r\n            tableRowClassName({row, rowIndex}) {\r\n                if (rowIndex%4 === 1) {\r\n                    return 'warning-row';\r\n                } else if (rowIndex%4 === 3) {\r\n                    return 'success-row';\r\n                }\r\n                return '';\r\n            },\r\n            // 全部折叠\r\n            allHidden(){\r\n                this.activeNames = [];\r\n            },\r\n            // 全部展开\r\n            allShow(){\r\n                this.allHidden();\r\n                /* 激活全部题组 */\r\n                for(let i = 0;i<this.studentExams.length;i++) this.$set(this.activeNames,i,i);\r\n            },\r\n            // 展开答案列表\r\n            solutionsShow(item){\r\n                for(let j in item.solutions){\r\n                    this.$set(item.activeNames,j,item.userId+j);\r\n                }\r\n            },\r\n            // 折叠答案列表\r\n            solutionsHidden(item){\r\n                item.activeNames = [];\r\n                this.allHidden();\r\n            },\r\n            // 分数检查\r\n            subjectiveScoreCheck(solution,stdScore){\r\n                if(solution.score > stdScore || solution.score < 0 || isNaN(solution.score)){\r\n                    solution.score = 0;\r\n                    this.$message.warning(\"输入格式有误\");\r\n                }\r\n            },\r\n            // 总分计算\r\n            calTotalScore(item){\r\n                item.score = 0 ;\r\n                for(let i in item.solutions){\r\n                    item.score += item.solutions[i].score;\r\n                }\r\n            },\r\n            // 提交评分-参数为StudentExam类型\r\n            submitScore(item){\r\n                this.$confirm('确认分数无误后提交, 是否继续?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    // item应提交给后台，保存其score和solutions中的score\r\n                    this.$axios.post(\"/Answer/judgeOnesPaper\",item).then((res)=>{\r\n                        if(res.data.flag){  // 持久化完成\r\n                            this.$message.success(res.data.msg);\r\n                            // 刷新数据\r\n                            this.getStudentExams();\r\n                        }else{\r\n                            this.$message.error(res.data.msg);\r\n                        }\r\n                    })\r\n                })\r\n            },\r\n            // 重新评分\r\n            reJudge(item){\r\n                this.$confirm('是否重新判卷?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    this.$axios.post(\"/Answer/reJudge\",item).then((res)=>{\r\n                        if(res.data.flag){\r\n                           item.isChecked = 0;\r\n                           item.isCheckedBool = false;\r\n                        }else{\r\n                            this.$message.error(res.data.msg);\r\n                        }\r\n                    })\r\n                })\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /* 信息卡片 */\r\n    #examCards{\r\n        width: 90%;\r\n        min-height: 10em;\r\n        margin: auto;\r\n    }\r\n    /* 考试标题 */\r\n    #examTitle{\r\n        margin-bottom: 1.2em;\r\n        font-size: 28px;\r\n        font-weight: 600;\r\n        font-family: \"微软雅黑\";\r\n    }\r\n    /* 发表时间 */\r\n    #examDate{\r\n        color: #8a8a8a;\r\n        margin-left: 1.2em;\r\n    }\r\n    /* 详情 */\r\n    #examDetails{\r\n        margin-top: 20px;\r\n        margin-bottom: 20px;\r\n    }\r\n    /* 分割线 */\r\n    ::v-deep#myDivider{\r\n        margin: 2em 0;\r\n    }\r\n    /**\r\n     * 功能栏\r\n     */\r\n    /* 题目卡片区 */\r\n    #subjectCard{\r\n        padding: 0;\r\n        position: relative;\r\n    }\r\n    /* 功能栏 */\r\n    #functionCard{\r\n        text-align: center;\r\n        margin-bottom: 1.2em;\r\n    }\r\n    /* 展开折叠按钮 */\r\n    .conSubjectButton{\r\n        left: 46em;\r\n        position: relative;\r\n    }\r\n    /**\r\n     * 标题栏\r\n     */\r\n    /* 暂无数据 */\r\n    #emptySubject{\r\n        margin-left: 39vw;\r\n        color:#8d8d8d;\r\n        height:3em;\r\n        line-height:2.5em;\r\n        font-size: 16px\r\n    }\r\n    /* 题目序号 */\r\n    .subjectNum{\r\n        left: 0.8em;\r\n        position: relative;\r\n    }\r\n    /* 标签整体 */\r\n    .tagBox{\r\n        left: 2.5em;\r\n        width: 100em;\r\n        position: absolute;\r\n    }\r\n    /* 用户头像显示 */\r\n    .userAvatar{\r\n        top: 0.3em;\r\n        position: relative;\r\n    }\r\n    /* 用户名显示 */\r\n    .username{\r\n        left: 2.4em;\r\n        margin: 0 1em;\r\n        bottom: 0.5em;\r\n        position: absolute;\r\n    }\r\n    /*　题目标签　*/\r\n    .subjectTag{\r\n        margin: 0 0.4em;\r\n        left: 5.5em;\r\n        bottom: 0.7em;\r\n        position: relative;\r\n    }\r\n    /**\r\n     * 内容区\r\n     */\r\n    .subjectContent{\r\n        width: 93%;\r\n        left: 3em;\r\n        position: relative;\r\n    }\r\n    /* 答案区tag */\r\n    .normalTag{\r\n        margin: 0 0.4em;\r\n    }\r\n    /* 题型tag */\r\n    .subjectTypeTag{\r\n        min-width: 85%;\r\n    }\r\n    /* 得分tag */\r\n    .scoreTag{\r\n        min-width: 75%;\r\n    }\r\n    /* 输入框高度 */\r\n    ::v-deep.el-input__inner{\r\n        height: 30px;\r\n    }\r\n    /* 主观题评分输入框 */\r\n    .inputScore{\r\n        bottom: 0.2em;\r\n        position: relative;\r\n    }\r\n    /* div 标准 */\r\n    .stdDiv{\r\n        margin: 0.3em 0;\r\n    }\r\n    /* 左右空隙div */\r\n    .lrDiv{\r\n        margin: 0 0.3em;\r\n    }\r\n    /**\r\n     * 功能区-编辑题目按钮\r\n     */\r\n    .editSubjectButton{\r\n        margin-top: 2em;\r\n        font-size: 14px;\r\n    }\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}