{"ast":null,"code":"import _typeof from \"F:/Desktop/\\u7E41\\u661F\\u6559\\u80B2/TH\\u8D44\\u6599/two_hours_front/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.entries.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { getBpmnId } from './bpmnIds';\nimport { lfJson2Xml } from './json2xml';\nimport { lfXml2Json } from './xml2json';\nimport { ExclusiveGatewayConfig, StartEventConfig, EndEventConfig, ServiceTaskConfig, UserTaskConfig } from '../bpmn/constant';\nvar BpmnElements;\n\n(function (BpmnElements) {\n  BpmnElements[\"START\"] = \"bpmn:startEvent\";\n  BpmnElements[\"END\"] = \"bpmn:endEvent\";\n  BpmnElements[\"GATEWAY\"] = \"bpmn:exclusiveGateway\";\n  BpmnElements[\"USER\"] = \"bpmn:userTask\";\n  BpmnElements[\"SYSTEM\"] = \"bpmn:serviceTask\";\n  BpmnElements[\"FLOW\"] = \"bpmn:sequenceFlow\";\n})(BpmnElements || (BpmnElements = {}));\n\nvar defaultAttrs = ['-name', '-id', 'bpmn:incoming', 'bpmn:outgoing', '-sourceRef', '-targetRef'];\n/**\n * 将普通json转换为xmljson\n * xmljson中properity会以“-”开头\n * 如果没有“-”表示为子节点\n */\n\nfunction toXmlJson(json) {\n  var xmlJson = {};\n  Object.entries(json).forEach(function (_a) {\n    var _b = __read(_a, 2),\n        key = _b[0],\n        value = _b[1];\n\n    if (_typeof(value) !== 'object') {\n      if (key.indexOf('-') === 0) {\n        // 如果本来就是“-”开头的了，那就不处理了。\n        xmlJson[key] = value;\n      } else {\n        xmlJson[\"-\" + key] = value;\n      }\n    } else {\n      xmlJson[key] = toXmlJson(value);\n    }\n  });\n  return xmlJson;\n}\n/**\n * 将xmlJson转换为普通的json，在内部使用。\n */\n\n\nfunction toNormalJson(xmlJson) {\n  var json = {};\n  Object.entries(xmlJson).forEach(function (_a) {\n    var _b = __read(_a, 2),\n        key = _b[0],\n        value = _b[1];\n\n    if (typeof value === 'string') {\n      if (key.indexOf('-') === 0) {\n        // 如果本来就是“-”开头的了，那就不处理了。\n        json[key.substr(1)] = value;\n      } else {\n        json[key] = value;\n      }\n    } else if (_typeof(value) === 'object') {\n      json[key] = toNormalJson(value);\n    } else {\n      json[key] = value;\n    }\n  });\n  return json;\n}\n/**\n * 设置bpmn process信息\n * 目标格式请参考examples/bpmn.json\n * bpmn因为是默认基于xml格式的，其特点与json存在差异。\n * 1) 如果是xml的属性，json中属性用'-'开头\n * 2）如果只有一个子元素，json中表示为正常属性\n * 3）如果是多个子元素，json中使用数组存储\n */\n\n\nfunction convertLf2ProcessData(bpmnProcessData, data) {\n  var nodeMap = new Map();\n  data.nodes.forEach(function (node) {\n    var _a;\n\n    var processNode = {\n      '-id': node.id\n    };\n\n    if ((_a = node.text) === null || _a === void 0 ? void 0 : _a.value) {\n      processNode['-name'] = node.text.value;\n    }\n\n    if (node.properties) {\n      var properties = toXmlJson(node.properties);\n      Object.assign(processNode, properties);\n    }\n\n    nodeMap.set(node.id, processNode);\n\n    if (!bpmnProcessData[node.type]) {\n      bpmnProcessData[node.type] = processNode; // 如果只有一个子元素，json中表示为正常属性\n    } else if (Array.isArray(bpmnProcessData[node.type])) {\n      // 如果是多个子元素，json中使用数组存储\n      bpmnProcessData[node.type].push(processNode);\n    } else {\n      // 如果是多个子元素，json中使用数组存储\n      bpmnProcessData[node.type] = [bpmnProcessData[node.type], processNode];\n    }\n  });\n  var sequenceFlow = data.edges.map(function (edge) {\n    var _a, _b;\n\n    var targetNode = nodeMap.get(edge.targetNodeId); // @see https://github.com/didi/LogicFlow/issues/325\n    // 需要保证incomming在outgoing之前\n\n    if (!targetNode['bpmn:incoming']) {\n      targetNode['bpmn:incoming'] = edge.id;\n    } else if (Array.isArray(targetNode['bpmn:incoming'])) {\n      targetNode['bpmn:incoming'].push(edge.id);\n    } else {\n      targetNode['bpmn:incoming'] = [targetNode['bpmn:incoming'], edge.id];\n    }\n\n    var sourceNode = nodeMap.get(edge.sourceNodeId);\n\n    if (!sourceNode['bpmn:outgoing']) {\n      sourceNode['bpmn:outgoing'] = edge.id;\n    } else if (Array.isArray(sourceNode['bpmn:outgoing'])) {\n      sourceNode['bpmn:outgoing'].push(edge.id);\n    } else {\n      // 字符串转数组\n      sourceNode['bpmn:outgoing'] = [sourceNode['bpmn:outgoing'], edge.id];\n    }\n\n    var edgeConfig = {\n      '-id': edge.id,\n      '-sourceRef': edge.sourceNodeId,\n      '-targetRef': edge.targetNodeId\n    };\n\n    if ((_a = edge.text) === null || _a === void 0 ? void 0 : _a.value) {\n      edgeConfig['-name'] = (_b = edge.text) === null || _b === void 0 ? void 0 : _b.value;\n    }\n\n    if (edge.properties) {\n      var properties = toXmlJson(edge.properties);\n      Object.assign(edgeConfig, properties);\n    }\n\n    return edgeConfig;\n  });\n  bpmnProcessData[BpmnElements.FLOW] = sequenceFlow;\n}\n/**\n * adapterOut 设置bpmn diagram信息\n */\n\n\nfunction convertLf2DiagramData(bpmnDiagramData, data) {\n  bpmnDiagramData['bpmndi:BPMNEdge'] = data.edges.map(function (edge) {\n    var _a;\n\n    var edgeId = edge.id;\n    var pointsList = edge.pointsList.map(function (_a) {\n      var x = _a.x,\n          y = _a.y;\n      return {\n        '-x': x,\n        '-y': y\n      };\n    });\n    var diagramData = {\n      '-id': edgeId + \"_di\",\n      '-bpmnElement': edgeId,\n      'di:waypoint': pointsList\n    };\n\n    if ((_a = edge.text) === null || _a === void 0 ? void 0 : _a.value) {\n      diagramData['bpmndi:BPMNLabel'] = {\n        'dc:Bounds': {\n          '-x': edge.text.x - edge.text.value.length * 10 / 2,\n          '-y': edge.text.y - 7,\n          '-width': edge.text.value.length * 10,\n          '-height': 14\n        }\n      };\n    }\n\n    return diagramData;\n  });\n  bpmnDiagramData['bpmndi:BPMNShape'] = data.nodes.map(function (node) {\n    var _a;\n\n    var nodeId = node.id;\n    var width = 100;\n    var height = 80;\n    var x = node.x,\n        y = node.y; // bpmn坐标是基于左上角，LogicFlow基于中心点，此处处理一下。\n\n    var shapeConfig = BpmnAdapter.shapeConfigMap.get(node.type);\n\n    if (shapeConfig) {\n      width = shapeConfig.width;\n      height = shapeConfig.height;\n    }\n\n    x -= width / 2;\n    y -= height / 2;\n    var diagramData = {\n      '-id': nodeId + \"_di\",\n      '-bpmnElement': nodeId,\n      'dc:Bounds': {\n        '-x': x,\n        '-y': y,\n        '-width': width,\n        '-height': height\n      }\n    };\n\n    if ((_a = node.text) === null || _a === void 0 ? void 0 : _a.value) {\n      diagramData['bpmndi:BPMNLabel'] = {\n        'dc:Bounds': {\n          '-x': node.text.x - node.text.value.length * 10 / 2,\n          '-y': node.text.y - 7,\n          '-width': node.text.value.length * 10,\n          '-height': 14\n        }\n      };\n    }\n\n    return diagramData;\n  });\n}\n/**\n * 将bpmn数据转换为LogicFlow内部能识别数据\n */\n\n\nfunction convertBpmn2LfData(bpmnData) {\n  var nodes = [];\n  var edges = [];\n  var definitions = bpmnData['bpmn:definitions'];\n\n  if (definitions) {\n    var process_1 = definitions['bpmn:process'];\n    Object.keys(process_1).forEach(function (key) {\n      if (key.indexOf('bpmn:') === 0) {\n        var value = process_1[key];\n\n        if (key === BpmnElements.FLOW) {\n          var bpmnEdges = definitions['bpmndi:BPMNDiagram']['bpmndi:BPMNPlane']['bpmndi:BPMNEdge'];\n          edges = getLfEdges(value, bpmnEdges);\n        } else {\n          var shapes = definitions['bpmndi:BPMNDiagram']['bpmndi:BPMNPlane']['bpmndi:BPMNShape'];\n          nodes = nodes.concat(getLfNodes(value, shapes, key));\n        }\n      }\n    });\n  }\n\n  return {\n    nodes: nodes,\n    edges: edges\n  };\n}\n\nfunction getLfNodes(value, shapes, key) {\n  var nodes = [];\n\n  if (Array.isArray(value)) {\n    // 数组\n    value.forEach(function (val) {\n      var shapeValue;\n\n      if (Array.isArray(shapes)) {\n        shapeValue = shapes.find(function (shape) {\n          return shape['-bpmnElement'] === val['-id'];\n        });\n      } else {\n        shapeValue = shapes;\n      }\n\n      var node = getNodeConfig(shapeValue, key, val);\n      nodes.push(node);\n    });\n  } else {\n    var shapeValue = void 0;\n\n    if (Array.isArray(shapes)) {\n      shapeValue = shapes.find(function (shape) {\n        return shape['-bpmnElement'] === value['-id'];\n      });\n    } else {\n      shapeValue = shapes;\n    }\n\n    var node = getNodeConfig(shapeValue, key, value);\n    nodes.push(node);\n  }\n\n  return nodes;\n}\n\nfunction getNodeConfig(shapeValue, type, processValue) {\n  var x = Number(shapeValue['dc:Bounds']['-x']);\n  var y = Number(shapeValue['dc:Bounds']['-y']);\n  var name = processValue['-name'];\n  var shapeConfig = BpmnAdapter.shapeConfigMap.get(type);\n\n  if (shapeConfig) {\n    x += shapeConfig.width / 2;\n    y += shapeConfig.height / 2;\n  }\n\n  var properties; // 判断是否存在额外的属性，将额外的属性放到properties中\n\n  Object.entries(processValue).forEach(function (_a) {\n    var _b = __read(_a, 2),\n        key = _b[0],\n        value = _b[1];\n\n    if (defaultAttrs.indexOf(key) === -1) {\n      if (!properties) properties = {};\n      properties[key] = value;\n    }\n  });\n\n  if (properties) {\n    properties = toNormalJson(properties);\n  }\n\n  var text;\n\n  if (name) {\n    text = {\n      x: x,\n      y: y,\n      value: name\n    }; // 自定义文本位置\n\n    if (shapeValue['bpmndi:BPMNLabel'] && shapeValue['bpmndi:BPMNLabel']['dc:Bounds']) {\n      var textBounds = shapeValue['bpmndi:BPMNLabel']['dc:Bounds'];\n      text.x = Number(textBounds['-x']) + Number(textBounds['-width']) / 2;\n      text.y = Number(textBounds['-y']) + Number(textBounds['-height']) / 2;\n    }\n  }\n\n  var nodeConfig = {\n    id: shapeValue['-bpmnElement'],\n    type: type,\n    x: x,\n    y: y,\n    properties: properties\n  };\n\n  if (text) {\n    nodeConfig.text = text;\n  }\n\n  return nodeConfig;\n}\n\nfunction getLfEdges(value, bpmnEdges) {\n  var edges = [];\n\n  if (Array.isArray(value)) {\n    value.forEach(function (val) {\n      var edgeValue;\n\n      if (Array.isArray(bpmnEdges)) {\n        edgeValue = bpmnEdges.find(function (edge) {\n          return edge['-bpmnElement'] === val['-id'];\n        });\n      } else {\n        edgeValue = bpmnEdges;\n      }\n\n      edges.push(getEdgeConfig(edgeValue, val));\n    });\n  } else {\n    var edgeValue = void 0;\n\n    if (Array.isArray(bpmnEdges)) {\n      edgeValue = bpmnEdges.find(function (edge) {\n        return edge['-bpmnElement'] === value['-id'];\n      });\n    } else {\n      edgeValue = bpmnEdges;\n    }\n\n    edges.push(getEdgeConfig(edgeValue, value));\n  }\n\n  return edges;\n}\n\nfunction getEdgeConfig(edgeValue, processValue) {\n  var text;\n  var textVal = processValue['-name'];\n\n  if (textVal) {\n    var textBounds = edgeValue['bpmndi:BPMNLabel']['dc:Bounds']; // 如果边文本换行，则其偏移量应该是最长一行的位置\n\n    var textLength_1 = 0;\n    textVal.split('\\n').forEach(function (textSpan) {\n      if (textLength_1 < textSpan.length) {\n        textLength_1 = textSpan.length;\n      }\n    });\n    text = {\n      value: textVal,\n      x: Number(textBounds['-x']) + textLength_1 * 10 / 2,\n      y: Number(textBounds['-y']) + 7\n    };\n  }\n\n  var properties; // 判断是否存在额外的属性，将额外的属性放到properties中\n\n  Object.entries(processValue).forEach(function (_a) {\n    var _b = __read(_a, 2),\n        key = _b[0],\n        value = _b[1];\n\n    if (defaultAttrs.indexOf(key) === -1) {\n      if (!properties) properties = {};\n      properties[key] = value;\n    }\n  });\n\n  if (properties) {\n    properties = toNormalJson(properties);\n  }\n\n  var edge = {\n    id: processValue['-id'],\n    type: BpmnElements.FLOW,\n    pointsList: edgeValue['di:waypoint'].map(function (point) {\n      return {\n        x: Number(point['-x']),\n        y: Number(point['-y'])\n      };\n    }),\n    sourceNodeId: processValue['-sourceRef'],\n    targetNodeId: processValue['-targetRef'],\n    properties: properties\n  };\n\n  if (text) {\n    edge.text = text;\n  }\n\n  return edge;\n}\n\nvar BpmnAdapter = {\n  pluginName: 'bpmn-adapter',\n  install: function install(lf) {\n    lf.adapterIn = this.adapterIn;\n    lf.adapterOut = this.adapterOut;\n  },\n  shapeConfigMap: new Map(),\n  setCustomShape: function setCustomShape(key, val) {\n    this.shapeConfigMap.set(key, val);\n  },\n  adapterOut: function adapterOut(data) {\n    var bpmnProcessData = {\n      '-id': \"Process_\" + getBpmnId(),\n      '-isExecutable': 'false'\n    };\n    convertLf2ProcessData(bpmnProcessData, data);\n    var bpmnDiagramData = {\n      '-id': 'BPMNPlane_1',\n      '-bpmnElement': bpmnProcessData['-id']\n    };\n    convertLf2DiagramData(bpmnDiagramData, data);\n    var bpmnData = {\n      'bpmn:definitions': {\n        '-id': \"Definitions_\" + getBpmnId(),\n        '-xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n        '-xmlns:bpmn': 'http://www.omg.org/spec/BPMN/20100524/MODEL',\n        '-xmlns:bpmndi': 'http://www.omg.org/spec/BPMN/20100524/DI',\n        '-xmlns:dc': 'http://www.omg.org/spec/DD/20100524/DC',\n        '-xmlns:di': 'http://www.omg.org/spec/DD/20100524/DI',\n        '-targetNamespace': 'http://bpmn.io/schema/bpmn',\n        '-exporter': 'bpmn-js (https://demo.bpmn.io)',\n        '-exporterVersion': '7.3.0',\n        'bpmn:process': bpmnProcessData,\n        'bpmndi:BPMNDiagram': {\n          '-id': 'BPMNDiagram_1',\n          'bpmndi:BPMNPlane': bpmnDiagramData\n        }\n      }\n    };\n    return bpmnData;\n  },\n  adapterIn: function adapterIn(bpmnData) {\n    if (bpmnData) {\n      return convertBpmn2LfData(bpmnData);\n    }\n  }\n};\nBpmnAdapter.shapeConfigMap.set(BpmnElements.START, {\n  width: StartEventConfig.width,\n  height: StartEventConfig.height\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.END, {\n  width: EndEventConfig.width,\n  height: EndEventConfig.height\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.GATEWAY, {\n  width: ExclusiveGatewayConfig.width,\n  height: ExclusiveGatewayConfig.height\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.SYSTEM, {\n  width: ServiceTaskConfig.width,\n  height: ServiceTaskConfig.height\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.USER, {\n  width: UserTaskConfig.width,\n  height: UserTaskConfig.height\n});\nvar BpmnXmlAdapter = {\n  pluginName: 'bpmnXmlAdapter',\n  install: function install(lf) {\n    lf.adapterIn = this.adapterXmlIn;\n    lf.adapterOut = this.adapterXmlOut;\n  },\n  adapterXmlIn: function adapterXmlIn(bpmnData) {\n    var json = lfXml2Json(bpmnData);\n    return BpmnAdapter.adapterIn(json);\n  },\n  adapterXmlOut: function adapterXmlOut(data) {\n    var outData = BpmnAdapter.adapterOut(data);\n    return lfJson2Xml(outData);\n  }\n};\nexport { BpmnAdapter, BpmnXmlAdapter };\nexport default BpmnAdapter;","map":{"version":3,"sources":["F:/Desktop/繁星教育/TH资料/two_hours_front/node_modules/@logicflow/extension/es/bpmn-adapter/index.js"],"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","getBpmnId","lfJson2Xml","lfXml2Json","ExclusiveGatewayConfig","StartEventConfig","EndEventConfig","ServiceTaskConfig","UserTaskConfig","BpmnElements","defaultAttrs","toXmlJson","json","xmlJson","Object","entries","forEach","_a","_b","key","indexOf","toNormalJson","substr","convertLf2ProcessData","bpmnProcessData","data","nodeMap","Map","nodes","node","processNode","id","text","properties","assign","set","type","Array","isArray","sequenceFlow","edges","map","edge","targetNode","get","targetNodeId","sourceNode","sourceNodeId","edgeConfig","FLOW","convertLf2DiagramData","bpmnDiagramData","edgeId","pointsList","x","y","diagramData","length","nodeId","width","height","shapeConfig","BpmnAdapter","shapeConfigMap","convertBpmn2LfData","bpmnData","definitions","process_1","keys","bpmnEdges","getLfEdges","shapes","concat","getLfNodes","val","shapeValue","find","shape","getNodeConfig","processValue","Number","name","textBounds","nodeConfig","edgeValue","getEdgeConfig","textVal","textLength_1","split","textSpan","point","pluginName","install","lf","adapterIn","adapterOut","setCustomShape","START","END","GATEWAY","SYSTEM","USER","BpmnXmlAdapter","adapterXmlIn","adapterXmlOut","outData"],"mappings":"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","sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { getBpmnId } from './bpmnIds';\nimport { lfJson2Xml } from './json2xml';\nimport { lfXml2Json } from './xml2json';\nimport { ExclusiveGatewayConfig, StartEventConfig, EndEventConfig, ServiceTaskConfig, UserTaskConfig, } from '../bpmn/constant';\nvar BpmnElements;\n(function (BpmnElements) {\n    BpmnElements[\"START\"] = \"bpmn:startEvent\";\n    BpmnElements[\"END\"] = \"bpmn:endEvent\";\n    BpmnElements[\"GATEWAY\"] = \"bpmn:exclusiveGateway\";\n    BpmnElements[\"USER\"] = \"bpmn:userTask\";\n    BpmnElements[\"SYSTEM\"] = \"bpmn:serviceTask\";\n    BpmnElements[\"FLOW\"] = \"bpmn:sequenceFlow\";\n})(BpmnElements || (BpmnElements = {}));\nvar defaultAttrs = ['-name', '-id', 'bpmn:incoming', 'bpmn:outgoing', '-sourceRef', '-targetRef'];\n/**\n * 将普通json转换为xmljson\n * xmljson中properity会以“-”开头\n * 如果没有“-”表示为子节点\n */\nfunction toXmlJson(json) {\n    var xmlJson = {};\n    Object.entries(json).forEach(function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        if (typeof value !== 'object') {\n            if (key.indexOf('-') === 0) { // 如果本来就是“-”开头的了，那就不处理了。\n                xmlJson[key] = value;\n            }\n            else {\n                xmlJson[\"-\" + key] = value;\n            }\n        }\n        else {\n            xmlJson[key] = toXmlJson(value);\n        }\n    });\n    return xmlJson;\n}\n/**\n * 将xmlJson转换为普通的json，在内部使用。\n */\nfunction toNormalJson(xmlJson) {\n    var json = {};\n    Object.entries(xmlJson).forEach(function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        if (typeof value === 'string') {\n            if (key.indexOf('-') === 0) { // 如果本来就是“-”开头的了，那就不处理了。\n                json[key.substr(1)] = value;\n            }\n            else {\n                json[key] = value;\n            }\n        }\n        else if (typeof value === 'object') {\n            json[key] = toNormalJson(value);\n        }\n        else {\n            json[key] = value;\n        }\n    });\n    return json;\n}\n/**\n * 设置bpmn process信息\n * 目标格式请参考examples/bpmn.json\n * bpmn因为是默认基于xml格式的，其特点与json存在差异。\n * 1) 如果是xml的属性，json中属性用'-'开头\n * 2）如果只有一个子元素，json中表示为正常属性\n * 3）如果是多个子元素，json中使用数组存储\n */\nfunction convertLf2ProcessData(bpmnProcessData, data) {\n    var nodeMap = new Map();\n    data.nodes.forEach(function (node) {\n        var _a;\n        var processNode = {\n            '-id': node.id,\n        };\n        if ((_a = node.text) === null || _a === void 0 ? void 0 : _a.value) {\n            processNode['-name'] = node.text.value;\n        }\n        if (node.properties) {\n            var properties = toXmlJson(node.properties);\n            Object.assign(processNode, properties);\n        }\n        nodeMap.set(node.id, processNode);\n        if (!bpmnProcessData[node.type]) {\n            bpmnProcessData[node.type] = processNode; // 如果只有一个子元素，json中表示为正常属性\n        }\n        else if (Array.isArray(bpmnProcessData[node.type])) { // 如果是多个子元素，json中使用数组存储\n            bpmnProcessData[node.type].push(processNode);\n        }\n        else { // 如果是多个子元素，json中使用数组存储\n            bpmnProcessData[node.type] = [\n                bpmnProcessData[node.type],\n                processNode,\n            ];\n        }\n    });\n    var sequenceFlow = data.edges.map(function (edge) {\n        var _a, _b;\n        var targetNode = nodeMap.get(edge.targetNodeId);\n        // @see https://github.com/didi/LogicFlow/issues/325\n        // 需要保证incomming在outgoing之前\n        if (!targetNode['bpmn:incoming']) {\n            targetNode['bpmn:incoming'] = edge.id;\n        }\n        else if (Array.isArray(targetNode['bpmn:incoming'])) {\n            targetNode['bpmn:incoming'].push(edge.id);\n        }\n        else {\n            targetNode['bpmn:incoming'] = [\n                targetNode['bpmn:incoming'],\n                edge.id,\n            ];\n        }\n        var sourceNode = nodeMap.get(edge.sourceNodeId);\n        if (!sourceNode['bpmn:outgoing']) {\n            sourceNode['bpmn:outgoing'] = edge.id;\n        }\n        else if (Array.isArray(sourceNode['bpmn:outgoing'])) {\n            sourceNode['bpmn:outgoing'].push(edge.id);\n        }\n        else { // 字符串转数组\n            sourceNode['bpmn:outgoing'] = [\n                sourceNode['bpmn:outgoing'],\n                edge.id,\n            ];\n        }\n        var edgeConfig = {\n            '-id': edge.id,\n            '-sourceRef': edge.sourceNodeId,\n            '-targetRef': edge.targetNodeId,\n        };\n        if ((_a = edge.text) === null || _a === void 0 ? void 0 : _a.value) {\n            edgeConfig['-name'] = (_b = edge.text) === null || _b === void 0 ? void 0 : _b.value;\n        }\n        if (edge.properties) {\n            var properties = toXmlJson(edge.properties);\n            Object.assign(edgeConfig, properties);\n        }\n        return edgeConfig;\n    });\n    bpmnProcessData[BpmnElements.FLOW] = sequenceFlow;\n}\n/**\n * adapterOut 设置bpmn diagram信息\n */\nfunction convertLf2DiagramData(bpmnDiagramData, data) {\n    bpmnDiagramData['bpmndi:BPMNEdge'] = data.edges.map(function (edge) {\n        var _a;\n        var edgeId = edge.id;\n        var pointsList = edge.pointsList.map(function (_a) {\n            var x = _a.x, y = _a.y;\n            return ({ '-x': x, '-y': y });\n        });\n        var diagramData = {\n            '-id': edgeId + \"_di\",\n            '-bpmnElement': edgeId,\n            'di:waypoint': pointsList,\n        };\n        if ((_a = edge.text) === null || _a === void 0 ? void 0 : _a.value) {\n            diagramData['bpmndi:BPMNLabel'] = {\n                'dc:Bounds': {\n                    '-x': edge.text.x - (edge.text.value.length * 10) / 2,\n                    '-y': edge.text.y - 7,\n                    '-width': edge.text.value.length * 10,\n                    '-height': 14,\n                },\n            };\n        }\n        return diagramData;\n    });\n    bpmnDiagramData['bpmndi:BPMNShape'] = data.nodes.map(function (node) {\n        var _a;\n        var nodeId = node.id;\n        var width = 100;\n        var height = 80;\n        var x = node.x, y = node.y;\n        // bpmn坐标是基于左上角，LogicFlow基于中心点，此处处理一下。\n        var shapeConfig = BpmnAdapter.shapeConfigMap.get(node.type);\n        if (shapeConfig) {\n            width = shapeConfig.width;\n            height = shapeConfig.height;\n        }\n        x -= width / 2;\n        y -= height / 2;\n        var diagramData = {\n            '-id': nodeId + \"_di\",\n            '-bpmnElement': nodeId,\n            'dc:Bounds': {\n                '-x': x,\n                '-y': y,\n                '-width': width,\n                '-height': height,\n            },\n        };\n        if ((_a = node.text) === null || _a === void 0 ? void 0 : _a.value) {\n            diagramData['bpmndi:BPMNLabel'] = {\n                'dc:Bounds': {\n                    '-x': node.text.x - (node.text.value.length * 10) / 2,\n                    '-y': node.text.y - 7,\n                    '-width': node.text.value.length * 10,\n                    '-height': 14,\n                },\n            };\n        }\n        return diagramData;\n    });\n}\n/**\n * 将bpmn数据转换为LogicFlow内部能识别数据\n */\nfunction convertBpmn2LfData(bpmnData) {\n    var nodes = [];\n    var edges = [];\n    var definitions = bpmnData['bpmn:definitions'];\n    if (definitions) {\n        var process_1 = definitions['bpmn:process'];\n        Object.keys(process_1).forEach(function (key) {\n            if (key.indexOf('bpmn:') === 0) {\n                var value = process_1[key];\n                if (key === BpmnElements.FLOW) {\n                    var bpmnEdges = definitions['bpmndi:BPMNDiagram']['bpmndi:BPMNPlane']['bpmndi:BPMNEdge'];\n                    edges = getLfEdges(value, bpmnEdges);\n                }\n                else {\n                    var shapes = definitions['bpmndi:BPMNDiagram']['bpmndi:BPMNPlane']['bpmndi:BPMNShape'];\n                    nodes = nodes.concat(getLfNodes(value, shapes, key));\n                }\n            }\n        });\n    }\n    return {\n        nodes: nodes,\n        edges: edges,\n    };\n}\nfunction getLfNodes(value, shapes, key) {\n    var nodes = [];\n    if (Array.isArray(value)) { // 数组\n        value.forEach(function (val) {\n            var shapeValue;\n            if (Array.isArray(shapes)) {\n                shapeValue = shapes.find(function (shape) { return shape['-bpmnElement'] === val['-id']; });\n            }\n            else {\n                shapeValue = shapes;\n            }\n            var node = getNodeConfig(shapeValue, key, val);\n            nodes.push(node);\n        });\n    }\n    else {\n        var shapeValue = void 0;\n        if (Array.isArray(shapes)) {\n            shapeValue = shapes.find(function (shape) { return shape['-bpmnElement'] === value['-id']; });\n        }\n        else {\n            shapeValue = shapes;\n        }\n        var node = getNodeConfig(shapeValue, key, value);\n        nodes.push(node);\n    }\n    return nodes;\n}\nfunction getNodeConfig(shapeValue, type, processValue) {\n    var x = Number(shapeValue['dc:Bounds']['-x']);\n    var y = Number(shapeValue['dc:Bounds']['-y']);\n    var name = processValue['-name'];\n    var shapeConfig = BpmnAdapter.shapeConfigMap.get(type);\n    if (shapeConfig) {\n        x += shapeConfig.width / 2;\n        y += shapeConfig.height / 2;\n    }\n    var properties;\n    // 判断是否存在额外的属性，将额外的属性放到properties中\n    Object.entries(processValue).forEach(function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        if (defaultAttrs.indexOf(key) === -1) {\n            if (!properties)\n                properties = {};\n            properties[key] = value;\n        }\n    });\n    if (properties) {\n        properties = toNormalJson(properties);\n    }\n    var text;\n    if (name) {\n        text = {\n            x: x,\n            y: y,\n            value: name,\n        };\n        // 自定义文本位置\n        if (shapeValue['bpmndi:BPMNLabel'] && shapeValue['bpmndi:BPMNLabel']['dc:Bounds']) {\n            var textBounds = shapeValue['bpmndi:BPMNLabel']['dc:Bounds'];\n            text.x = Number(textBounds['-x']) + Number(textBounds['-width']) / 2;\n            text.y = Number(textBounds['-y']) + Number(textBounds['-height']) / 2;\n        }\n    }\n    var nodeConfig = {\n        id: shapeValue['-bpmnElement'],\n        type: type,\n        x: x,\n        y: y,\n        properties: properties,\n    };\n    if (text) {\n        nodeConfig.text = text;\n    }\n    return nodeConfig;\n}\nfunction getLfEdges(value, bpmnEdges) {\n    var edges = [];\n    if (Array.isArray(value)) {\n        value.forEach(function (val) {\n            var edgeValue;\n            if (Array.isArray(bpmnEdges)) {\n                edgeValue = bpmnEdges.find(function (edge) { return edge['-bpmnElement'] === val['-id']; });\n            }\n            else {\n                edgeValue = bpmnEdges;\n            }\n            edges.push(getEdgeConfig(edgeValue, val));\n        });\n    }\n    else {\n        var edgeValue = void 0;\n        if (Array.isArray(bpmnEdges)) {\n            edgeValue = bpmnEdges.find(function (edge) { return edge['-bpmnElement'] === value['-id']; });\n        }\n        else {\n            edgeValue = bpmnEdges;\n        }\n        edges.push(getEdgeConfig(edgeValue, value));\n    }\n    return edges;\n}\nfunction getEdgeConfig(edgeValue, processValue) {\n    var text;\n    var textVal = processValue['-name'];\n    if (textVal) {\n        var textBounds = edgeValue['bpmndi:BPMNLabel']['dc:Bounds'];\n        // 如果边文本换行，则其偏移量应该是最长一行的位置\n        var textLength_1 = 0;\n        textVal.split('\\n').forEach(function (textSpan) {\n            if (textLength_1 < textSpan.length) {\n                textLength_1 = textSpan.length;\n            }\n        });\n        text = {\n            value: textVal,\n            x: Number(textBounds['-x']) + (textLength_1 * 10) / 2,\n            y: Number(textBounds['-y']) + 7,\n        };\n    }\n    var properties;\n    // 判断是否存在额外的属性，将额外的属性放到properties中\n    Object.entries(processValue).forEach(function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        if (defaultAttrs.indexOf(key) === -1) {\n            if (!properties)\n                properties = {};\n            properties[key] = value;\n        }\n    });\n    if (properties) {\n        properties = toNormalJson(properties);\n    }\n    var edge = {\n        id: processValue['-id'],\n        type: BpmnElements.FLOW,\n        pointsList: edgeValue['di:waypoint'].map(function (point) { return ({\n            x: Number(point['-x']),\n            y: Number(point['-y']),\n        }); }),\n        sourceNodeId: processValue['-sourceRef'],\n        targetNodeId: processValue['-targetRef'],\n        properties: properties,\n    };\n    if (text) {\n        edge.text = text;\n    }\n    return edge;\n}\nvar BpmnAdapter = {\n    pluginName: 'bpmn-adapter',\n    install: function (lf) {\n        lf.adapterIn = this.adapterIn;\n        lf.adapterOut = this.adapterOut;\n    },\n    shapeConfigMap: new Map(),\n    setCustomShape: function (key, val) {\n        this.shapeConfigMap.set(key, val);\n    },\n    adapterOut: function (data) {\n        var bpmnProcessData = {\n            '-id': \"Process_\" + getBpmnId(),\n            '-isExecutable': 'false',\n        };\n        convertLf2ProcessData(bpmnProcessData, data);\n        var bpmnDiagramData = {\n            '-id': 'BPMNPlane_1',\n            '-bpmnElement': bpmnProcessData['-id'],\n        };\n        convertLf2DiagramData(bpmnDiagramData, data);\n        var bpmnData = {\n            'bpmn:definitions': {\n                '-id': \"Definitions_\" + getBpmnId(),\n                '-xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n                '-xmlns:bpmn': 'http://www.omg.org/spec/BPMN/20100524/MODEL',\n                '-xmlns:bpmndi': 'http://www.omg.org/spec/BPMN/20100524/DI',\n                '-xmlns:dc': 'http://www.omg.org/spec/DD/20100524/DC',\n                '-xmlns:di': 'http://www.omg.org/spec/DD/20100524/DI',\n                '-targetNamespace': 'http://bpmn.io/schema/bpmn',\n                '-exporter': 'bpmn-js (https://demo.bpmn.io)',\n                '-exporterVersion': '7.3.0',\n                'bpmn:process': bpmnProcessData,\n                'bpmndi:BPMNDiagram': {\n                    '-id': 'BPMNDiagram_1',\n                    'bpmndi:BPMNPlane': bpmnDiagramData,\n                },\n            },\n        };\n        return bpmnData;\n    },\n    adapterIn: function (bpmnData) {\n        if (bpmnData) {\n            return convertBpmn2LfData(bpmnData);\n        }\n    },\n};\nBpmnAdapter.shapeConfigMap.set(BpmnElements.START, {\n    width: StartEventConfig.width,\n    height: StartEventConfig.height,\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.END, {\n    width: EndEventConfig.width,\n    height: EndEventConfig.height,\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.GATEWAY, {\n    width: ExclusiveGatewayConfig.width,\n    height: ExclusiveGatewayConfig.height,\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.SYSTEM, {\n    width: ServiceTaskConfig.width,\n    height: ServiceTaskConfig.height,\n});\nBpmnAdapter.shapeConfigMap.set(BpmnElements.USER, {\n    width: UserTaskConfig.width,\n    height: UserTaskConfig.height,\n});\nvar BpmnXmlAdapter = {\n    pluginName: 'bpmnXmlAdapter',\n    install: function (lf) {\n        lf.adapterIn = this.adapterXmlIn;\n        lf.adapterOut = this.adapterXmlOut;\n    },\n    adapterXmlIn: function (bpmnData) {\n        var json = lfXml2Json(bpmnData);\n        return BpmnAdapter.adapterIn(json);\n    },\n    adapterXmlOut: function (data) {\n        var outData = BpmnAdapter.adapterOut(data);\n        return lfJson2Xml(outData);\n    },\n};\nexport { BpmnAdapter, BpmnXmlAdapter, };\nexport default BpmnAdapter;\n"]},"metadata":{},"sourceType":"module"}